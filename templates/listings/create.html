<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Listing - NEXUS</title>
    <meta name="description" content="Add a new product to the marketplace.">
    <link rel="icon" href="/static/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="/static/css/main.css">
    <link rel="stylesheet" href="/static/css/listing-preview.css">
    <style>
        /* Basic styling for card and form elements to match the overall theme */
        .card {
            background-color: #242424;
            border: 1px solid var(--color-border);
            border-radius: 4px;
            color: var(--color-foreground);
        }
        .card-header {
            padding: 1rem;
            border-bottom: 1px solid var(--color-border);
        }
        .card-content {
            padding: 1rem;
        }
        .label {
            display: block;
            margin-bottom: 0.5rem;
            font-size: 0.75rem;
            font-weight: 600;
            color: hsl(var(--foreground));
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        .input, .textarea, .select {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid var(--color-border);
            background-color: #1A1A1A;
            color: var(--color-foreground);
            border-radius: 4px;
        }
        .textarea {
            min-height: 120px;
        }
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }
        .btn-primary {
            background-color: var(--color-accent);
            color: var(--color-background);
        }
        .btn-secondary {
            background-color: transparent;
            border: 1px solid var(--color-border);
            color: var(--color-foreground);
        }
        .btn-lg {
            font-size: 1rem;
            padding: 0.75rem 1.5rem;
        }
        .container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 8rem 1.5rem 0;
        }
        .nexus-breadcrumb-list {
            display: flex;
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .nexus-breadcrumb-item {
            display: flex;
            align-items: center;
        }
        .nexus-breadcrumb-link {
            color: var(--color-foreground);
            text-decoration: none;
        }
        .nexus-breadcrumb-separator {
            margin: 0 0.5rem;
            color: var(--color-foreground);
        }
        .nexus-breadcrumb-current {
            color: var(--color-accent);
        }
        small {
            display: block;
            margin-top: 0.5rem;
            font-size: 0.75rem;
            color: hsl(var(--muted-foreground));
        }
        #image-preview {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }
        #image-preview img {
            width: 100%;
            height: 100px;
            object-fit: cover;
            border-radius: 4px;
            border: 1px solid var(--color-border);
        }
    </style>
</head>
<body>
    {% include "header.html" %}

    <main class="container">
        {# Breadcrumb Navigation #}
        <nav aria-label="Breadcrumb" style="max-width: 900px; margin: 0 auto; padding: 1.5rem 1.5rem 0;">
          <ol style="display: flex; align-items: center; gap: 0.5rem; list-style: none; padding: 0; margin: 0; font-size: 0.875rem; color: hsl(var(--muted-foreground));">
            <li>
              <a href="/" hx-boost="true" style="color: hsl(var(--foreground)); text-decoration: none; transition: color 0.2s;">Home</a>
              <span style="margin-left: 0.5rem; color: hsl(var(--muted-foreground));">/</span>
            </li>
            <li>
              <a href="/listings" hx-boost="true" style="color: hsl(var(--foreground)); text-decoration: none; transition: color 0.2s;">Listings</a>
              <span style="margin-left: 0.5rem; color: hsl(var(--muted-foreground));">/</span>
            </li>
            <li style="color: hsl(var(--primary)); font-weight: 500;" aria-current="page">
              Create
            </li>
          </ol>
        </nav>

        {# Form Container with Preview Layout #}
        <div class="section container" style="padding-top: 2rem; max-width: 1400px;">
          <div class="create-listing-layout">
            <!-- Form Column -->
            <div class="card">
              <div class="card-header" style="text-align: center; border-bottom: 1px solid hsl(var(--border)); padding-bottom: 1.5rem; margin-bottom: 2rem;">
                <h1 class="section-title" style="margin: 0;">
                  Create New Listing
                </h1>
                <p class="section-subtitle" style="margin-top: 0.5rem;">
                  Add a new product to the marketplace
                </p>
              </div>

            <div class="card-content">
              <form id="create-listing-form" enctype="multipart/form-data" style="display: flex; flex-direction: column; gap: 2rem;">
                <input type="hidden" name="csrf_token" value="{{ csrf_token }}">

                {# Title Field #}
                <div>
                  <label for="title" class="label">
                    Title
                  </label>
                  <input
                    type="text"
                    id="title"
                    name="title"
                    placeholder="Product title"
                    required
                    minlength="3"
                    maxlength="200"
                    class="input"
                  >
                  <small>
                    3-200 characters
                  </small>
                </div>

                {# Description Field #}
                <div>
                  <label for="description" class="label">
                    Description
                  </label>
                  <textarea
                    id="description"
                    name="description"
                    placeholder="Describe your product in detail..."
                    rows="6"
                    required
                    minlength="10"
                    maxlength="5000"
                    class="textarea"
                  ></textarea>
                  <small>
                    10-5000 characters
                  </small>
                </div>

                {# Category Field #}
                <div>
                  <label for="category" class="label">
                    Category
                  </label>
                  <select
                    id="category"
                    name="category"
                    required
                    class="select"
                  >
                    <option value="">Select a category...</option>
                    <option value="digital">üíª Digital Goods</option>
                    <option value="physical">üì¶ Physical Goods</option>
                    <option value="services">üõ†Ô∏è Services</option>
                    <option value="vpn">üîí VPN & Privacy</option>
                    <option value="hosting">üåê Web Hosting</option>
                    <option value="software">‚öôÔ∏è Software & Tools</option>
                    <option value="tutorials">üìö Tutorials & Guides</option>
                    <option value="accounts">üë§ Accounts & Subscriptions</option>
                    <option value="other">üîπ Other</option>
                  </select>
                  <small>
                    Select the category that best matches your product
                  </small>
                </div>

                {# Price Section - XMR Converter Widget #}
                <div>
                  <label class="label">
                    <i data-lucide="coins" style="width: 14px; height: 14px; display: inline-block; vertical-align: text-bottom;"></i>
                    Product Price
                  </label>

                  <div class="xmr-converter-widget" style="
                    background: rgba(255, 255, 255, 0.02);
                    border: 1px solid var(--color-border);
                    border-radius: 4px;
                    padding: 1.5rem;
                    margin-bottom: 1rem;
                  ">
                    <div style="display: grid; grid-template-columns: 1fr auto 1fr; gap: 1rem; align-items: center;">
                      <!-- XMR Input -->
                      <div>
                        <label for="price-xmr-human" style="
                          display: block;
                          font-size: 0.75rem;
                          font-weight: 600;
                          color: var(--color-foreground);
                          text-transform: uppercase;
                          letter-spacing: 0.05em;
                          margin-bottom: 0.5rem;
                        ">XMR (Decimal)</label>
                        <input
                          type="number"
                          id="price-xmr-human"
                          step="0.000000000001"
                          min="0"
                          placeholder="0.050000000000"
                          style="
                            width: 100%;
                            padding: 0.75rem;
                            background: #1A1A1A;
                            border: 1px solid var(--color-border);
                            border-radius: 4px;
                            color: var(--color-accent);
                            font-family: monospace;
                            font-size: 1rem;
                          "
                        >
                        <small style="color: rgba(255, 255, 255, 0.6); font-size: 0.7rem;">Easy to read</small>
                      </div>

                      <!-- Swap Icon -->
                      <div style="
                        color: var(--color-accent);
                        margin-top: 1rem;
                      ">
                        <i data-lucide="arrow-left-right" style="width: 20px; height: 20px;"></i>
                      </div>

                      <!-- Atomic Input (sent to backend) -->
                      <div>
                        <label for="price_xmr" style="
                          display: block;
                          font-size: 0.75rem;
                          font-weight: 600;
                          color: var(--color-foreground);
                          text-transform: uppercase;
                          letter-spacing: 0.05em;
                          margin-bottom: 0.5rem;
                        ">PICONEROS (ATOMIC)</label>
                        <input
                          type="number"
                          id="price_xmr"
                          name="price_xmr"
                          step="1"
                          min="1"
                          placeholder="50000000000"
                          required
                          readonly
                          style="
                            width: 100%;
                            padding: 0.75rem;
                            background: #1A1A1A;
                            border: 1px solid var(--color-border);
                            border-radius: 4px;
                            color: var(--color-foreground);
                            font-family: monospace;
                            font-size: 1rem;
                          "
                        >
                        <small style="color: rgba(255, 255, 255, 0.6); font-size: 0.7rem;">Sent to blockchain</small>
                      </div>
                    </div>

                    <!-- Info Banner -->
                    <div style="
                      margin-top: 1rem;
                      padding: 0.75rem;
                      background: rgba(201, 164, 69, 0.1);
                      border: 1px solid rgba(201, 164, 69, 0.3);
                      border-radius: 4px;
                      display: flex;
                      gap: 0.75rem;
                      align-items: center;
                    ">
                      <i data-lucide="info" style="width: 16px; height: 16px; color: var(--color-accent); flex-shrink: 0;"></i>
                      <span style="font-size: 0.75rem; color: rgba(255, 255, 255, 0.7);">
                        <strong>1 XMR = 1,000,000,000,000 piconeros.</strong> Enter price in XMR (left) for automatic conversion.
                      </span>
                    </div>
                  </div>
                </div>

                {# Stock Field #}
                <div>
                  <label for="stock" class="label">
                    <i data-lucide="package" style="width: 14px; height: 14px; display: inline-block; vertical-align: text-bottom;"></i>
                    Available Stock
                  </label>
                  <input
                    type="number"
                    id="stock"
                    name="stock"
                    placeholder="10"
                    min="0"
                    required
                    class="input"
                  >
                  <small>
                    Number of units available for sale
                  </small>
                </div>

                {# Images Field #}
                <div>
                  <label for="images" class="label">
                    Product Images
                  </label>
                  <input
                    type="file"
                    id="images"
                    name="images"
                    accept="image/jpeg,image/png,image/gif"
                    multiple
                    class="input"
                  >
                  <small>
                    Upload one or more images (JPEG, PNG, GIF) - Max 10 images, 5MB each
                  </small>
                  <div id="image-preview"></div>
                </div>

                {# Form Actions #}
                <div style="display: flex; gap: 1rem; padding-top: 1.5rem; border-top: 1px solid hsl(var(--border));">
                  <a href="/listings" hx-boost="true" class="btn btn-secondary btn-lg" style="flex: 1; text-decoration: none; display: inline-flex; align-items: center; justify-content: center;">
                    Cancel
                  </a>
                  <button type="submit" class="btn btn-primary btn-lg" style="flex: 1;">
                    Create Listing ‚Üí
                  </button>
                </div>
              </form>

              {# Response Container #}
              <div id="listing-result" style="margin-top: 1.5rem;"></div>
            </div>
          </div>

          <!-- Preview Column -->
          <aside class="listing-preview-container">
            <div class="listing-preview-header">
              <div>
                <i data-lucide="eye"></i>
              </div>
              <div style="flex: 1;">
                <h2 class="listing-preview-title">Live Preview</h2>
                <p class="listing-preview-subtitle">See how your listing will appear</p>
              </div>
            </div>

            <div id="listing-preview" data-vendor-name="{{ username }}">
              <!-- Preview will be rendered here by JavaScript -->
            </div>

            <div class="listing-preview-notice">
              <i data-lucide="info"></i>
              <p class="listing-preview-notice-text">
                This is a real-time preview of your listing. Changes you make to the form will be reflected here instantly.
              </p>
            </div>
          </aside>
        </div>
        </div>
    </main>

    <script src="/static/js/lucide.min.js"></script>
    <script src="/static/js/base.js"></script>
    <script src="/static/js/xmr-converter.js"></script>
    <script src="/static/js/listing-preview.js"></script>
    <script src="/static/js/create-listing.js"></script>
    <script src="/static/js/create-listing-init.js"></script>
</body>
</html>