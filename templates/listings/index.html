{% extends "base-nexus.html" %}

{% block title %}NEXUS — Anonymous Marketplace{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="/static/css/nexus-true.css">
{% endblock %}

{% block content %}

{# TRUE NEXUS HERO - Full Screen with Animated Letters #}
<section class="nexus-hero-true">
  {# Background Pattern with Wave Animation #}
  <div class="nexus-hero-pattern" style="background-image: url('/static/hero-pattern.png');"></div>

  {# Animated Grid Lines #}
  <div class="nexus-hero-grid"></div>

  {# Floating Geometric Shapes #}
  <div class="nexus-floating-shape nexus-floating-shape-1"></div>
  <div class="nexus-floating-shape nexus-floating-shape-2"></div>
  <div class="nexus-floating-shape nexus-floating-shape-3"></div>

  {# Content #}
  <div class="nexus-hero-content-true">
    {# Top Text #}
    <div class="nexus-hero-top-text">
      ANONYMOUS • SECURE • DECENTRALIZED
    </div>

    {# Main Title with Interactive Letters #}
    <h1 class="nexus-hero-title-true" id="nexus-title">
      <span class="nexus-animated-letter" data-letter="N" role="button" tabindex="0" aria-label="Animate letter N">N</span>
      <span class="nexus-animated-letter nexus-letter-e" data-letter="E" role="button" tabindex="0" aria-label="Animate letter E">E</span>
      <span class="nexus-animated-letter" data-letter="X" role="button" tabindex="0" aria-label="Animate letter X">X</span>
      <span class="nexus-animated-letter" data-letter="U" role="button" tabindex="0" aria-label="Animate letter U">U</span>
      <span class="nexus-animated-letter" data-letter="S" role="button" tabindex="0" aria-label="Animate letter S">S</span>
    </h1>

    {# Subtitle #}
    <p class="nexus-hero-subtitle-true">
      UNDERGROUND • MARKETPLACE
    </p>

    {# Stats #}
    <div class="nexus-hero-stats">
      <div class="nexus-hero-stat">
        <div class="nexus-hero-stat-value">{{ listings | length | default(value=1337) }}</div>
        <div class="nexus-hero-stat-label">LISTINGS</div>
      </div>
      <div class="nexus-hero-stat">
        <div class="nexus-hero-stat-value">420</div>
        <div class="nexus-hero-stat-label">VENDORS</div>
      </div>
      <div class="nexus-hero-stat">
        <div class="nexus-hero-stat-value">100%</div>
        <div class="nexus-hero-stat-label">ANONYMOUS</div>
      </div>
    </div>
  </div>

  {# Scroll Indicator #}
  <div class="nexus-scroll-indicator">
    <div class="nexus-scroll-text">SCROLL</div>
    <div class="nexus-scroll-line"></div>
  </div>
</section>

{# Browse Categories Section #}
<section id="categories" style="padding: 6rem 0; background: hsl(0, 0%, 5%);">
  <div style="max-width: 1400px; margin: 0 auto; padding: 0 1.5rem;">
    <div style="margin-bottom: 4rem; text-align: center;">
      <h2 class="nexus-section-title-huge">
        BROWSE CATEGORIES
      </h2>
      <p class="nexus-section-subtitle-bold">
        SECURE • ANONYMOUS • UNTRACEABLE
      </p>
    </div>

    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.5rem;">
      <!-- Digital Goods -->
      <a href="/categories/digital" style="text-decoration: none;" hx-boost="true">
        <div class="nexus-category-card">
          <div class="nexus-category-card-header">
            <svg class="nexus-category-card-icon" xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/></svg>
            <div class="nexus-category-card-count">
              <div class="nexus-category-card-count-value">342</div>
              <div class="nexus-category-card-count-label">ITEMS</div>
            </div>
          </div>
          <h3 class="nexus-category-card-title">DIGITAL GOODS</h3>
        </div>
      </a>

      <!-- Electronics -->
      <a href="/categories/electronics" style="text-decoration: none;" hx-boost="true">
        <div class="nexus-category-card">
          <div class="nexus-category-card-header">
            <svg class="nexus-category-card-icon" xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="7" width="20" height="15" rx="2" ry="2"/><polyline points="17 2 12 7 7 2"/></svg>
            <div class="nexus-category-card-count">
              <div class="nexus-category-card-count-value">156</div>
              <div class="nexus-category-card-count-label">ITEMS</div>
            </div>
          </div>
          <h3 class="nexus-category-card-title">ELECTRONICS</h3>
        </div>
      </a>

      <!-- Pharmaceuticals -->
      <a href="/categories/pharmaceuticals" style="text-decoration: none;" hx-boost="true">
        <div class="nexus-category-card">
          <div class="nexus-category-card-header">
            <svg class="nexus-category-card-icon" xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m10.5 20.5 10-10a4.95 4.95 0 1 0-7-7l-10 10a4.95 4.95 0 1 0 7 7Z"/><path d="m8.5 8.5 7 7"/></svg>
            <div class="nexus-category-card-count">
              <div class="nexus-category-card-count-value">203</div>
              <div class="nexus-category-card-count-label">ITEMS</div>
            </div>
          </div>
          <h3 class="nexus-category-card-title">PHARMACEUTICALS</h3>
        </div>
      </a>

      <!-- Documents -->
      <a href="/categories/documents" style="text-decoration: none;" hx-boost="true">
        <div class="nexus-category-card">
          <div class="nexus-category-card-header">
            <svg class="nexus-category-card-icon" xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
            <div class="nexus-category-card-count">
              <div class="nexus-category-card-count-value">89</div>
              <div class="nexus-category-card-count-label">ITEMS</div>
            </div>
          </div>
          <h3 class="nexus-category-card-title">DOCUMENTS</h3>
        </div>
      </a>

      <!-- Financial -->
      <a href="/categories/financial" style="text-decoration: none;" hx-boost="true">
        <div class="nexus-category-card">
          <div class="nexus-category-card-header">
            <svg class="nexus-category-card-icon" xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="7" width="20" height="14" rx="2" ry="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></svg>
            <div class="nexus-category-card-count">
              <div class="nexus-category-card-count-value">127</div>
              <div class="nexus-category-card-count-label">ITEMS</div>
            </div>
          </div>
          <h3 class="nexus-category-card-title">FINANCIAL</h3>
        </div>
      </a>

      <!-- Security -->
      <a href="/categories/security" style="text-decoration: none;" hx-boost="true">
        <div class="nexus-category-card">
          <div class="nexus-category-card-header">
            <svg class="nexus-category-card-icon" xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
            <div class="nexus-category-card-count">
              <div class="nexus-category-card-count-value">94</div>
              <div class="nexus-category-card-count-label">ITEMS</div>
            </div>
          </div>
          <h3 class="nexus-category-card-title">SECURITY</h3>
        </div>
      </a>
    </div>
  </div>
</section>

{# Featured Listings Section #}
<section id="listings" style="padding: 6rem 0; background: hsla(0, 0%, 15%, 0.3);">
  <div style="max-width: 1400px; margin: 0 auto; padding: 0 1.5rem;">
    <div style="margin-bottom: 4rem; display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 2rem;">
      <div>
        <h2 class="nexus-section-title-huge">
          FEATURED LISTINGS
        </h2>
        <p class="nexus-section-subtitle-bold">
          VERIFIED VENDORS • ESCROW PROTECTED
        </p>
      </div>
      <a href="/listings" class="nexus-btn nexus-btn-primary nexus-btn-lg" hx-boost="true" style="font-weight: 700;">
        VIEW ALL
      </a>
    </div>

  <div id="listings-results" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1.5rem;">
    {% if listings and listings | length > 0 %}
      {% for listing in listings %}
      <a href="/listings/{{ listing.id }}" style="text-decoration: none; color: inherit;" hx-boost="true">
        <div class="nexus-product-card">
          {# Product Image with Gradient #}
          <div class="nexus-product-image">
            <div class="nexus-product-image-gradient"></div>
            {% if listing.first_image_cid %}
              <img src="http://127.0.0.1:8081/ipfs/{{ listing.first_image_cid }}"
                   alt="{{ listing.title }}"
                   class="nexus-product-image-actual"
                   onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
              <div class="nexus-product-image-placeholder" style="display: none;">?</div>
            {% else %}
              <div class="nexus-product-image-placeholder">?</div>
            {% endif %}

            {# Verified Badge (if listing is active/verified) #}
            {% if listing.status == "active" %}
            <div class="nexus-verified-badge">
              <svg class="nexus-verified-badge-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
              VERIFIED
            </div>
            {% endif %}
          </div>

          {# Product Content #}
          <div class="nexus-product-content">
            <div class="nexus-product-info">
              <h3 class="nexus-product-title">{{ listing.title }}</h3>
              <p class="nexus-product-vendor">BY {{ listing.vendor_username | upper }}</p>
            </div>

            {# Rating Stars #}
            <div class="nexus-product-rating">
              <div class="nexus-product-stars">
                {# 5 filled stars for now - can be dynamic later #}
                <svg class="nexus-product-star" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                <svg class="nexus-product-star" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                <svg class="nexus-product-star" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                <svg class="nexus-product-star" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                <svg class="nexus-product-star" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
              </div>
              <span class="nexus-product-rating-text">5/5</span>
            </div>

            {# Price and View Button #}
            <div class="nexus-product-footer">
              <div class="nexus-product-price-container">
                <div class="nexus-product-price">{{ listing.price_xmr }}</div>
                <div class="nexus-product-price-label">XMR</div>
              </div>
              <button class="nexus-product-view-btn">VIEW</button>
            </div>
          </div>
        </div>
      </a>
      {% endfor %}
    {% else %}
      {# Empty State #}
      <div style="grid-column: 1 / -1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 5rem; text-align: center;">
        <div class="nexus-alert nexus-alert-info">
          <div class="nexus-alert-icon">ℹ️</div>
          <div class="nexus-alert-content">
            <div class="nexus-alert-title">No listings yet</div>
            <div class="nexus-alert-message">
              Be the first to create a listing on the marketplace!
            </div>
          </div>
        </div>

        {% if logged_in and role == "vendor" %}
        <a href="/listings/create" class="nexus-btn nexus-btn-primary" style="margin-top: 2rem;">
          Create Your First Listing
        </a>
        {% endif %}
      </div>
    {% endif %}
  </div>
  </div>
</section>

{# Stats Banner - Original Nexus Design #}
<section class="nexus-stats-banner">
  <div class="nexus-stats-container">
    <div class="nexus-stats-grid">
      <div class="nexus-stat-item">
        <div class="nexus-stat-value">24/7</div>
        <div class="nexus-stat-label">UPTIME</div>
      </div>
      <div class="nexus-stat-item">
        <div class="nexus-stat-value">0</div>
        <div class="nexus-stat-label">LOGS KEPT</div>
      </div>
      <div class="nexus-stat-item">
        <div class="nexus-stat-value">256</div>
        <div class="nexus-stat-label">BIT ENCRYPTION</div>
      </div>
      <div class="nexus-stat-item">
        <div class="nexus-stat-value">∞</div>
        <div class="nexus-stat-label">ANONYMITY</div>
      </div>
    </div>
  </div>
</section>

{% endblock %}

{% block scripts %}
<script src="/static/js/nexus-letters-animation.js"></script>
{% endblock %}
