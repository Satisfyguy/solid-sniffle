{% extends "base-nexus.html" %}

{% block title %}NEXUS ‚Äî SECURE MONERO MARKETPLACE{% endblock %}

{% block content %}

{# Hero Section #}
{% include "partials/nexus/organisms/hero.html" with
   title="NEXUS"
   subtitle="Secure Privacy-Focused Marketplace"
   description="2-of-3 Multisig Escrow ‚Ä¢ Non-Custodial ‚Ä¢ Monero Only ‚Ä¢ Tor Network"
   cta_primary_text="Browse Listings"
   cta_primary_url="/listings"
   cta_secondary_text="How It Works"
   cta_secondary_url="/faq"
   animated=true
   show_stats=true
   stats=[
     {"label": "Active Listings", "value": listings | length | default(value=0), "icon": "üì¶"},
     {"label": "Escrow Transactions", "value": "42", "icon": "üîí"},
     {"label": "Happy Users", "value": "127", "icon": "üòä"}
   ]
%}

{# Search Bar #}
<section style="max-width: 1400px; margin: 0 auto; padding: var(--nexus-space-12) var(--nexus-space-6);">
  {% include "partials/nexus/organisms/search-bar.html" with
     placeholder="Search listings..."
     action="/api/listings/search"
     hx_get="/api/listings/search"
     hx_target="#listings-results"
     filters=true
  %}
</section>

{# Featured Categories #}
<section style="max-width: 1400px; margin: 0 auto; padding: 0 var(--nexus-space-6) var(--nexus-space-12);">
  <h2 style="font-size: var(--nexus-text-3xl); font-weight: var(--nexus-weight-bold); color: var(--nexus-fg); margin-bottom: var(--nexus-space-8); text-align: center; text-transform: uppercase; letter-spacing: var(--nexus-tracking-wide);">
    Featured Categories
  </h2>

  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: var(--nexus-space-6);">
    {% include "partials/nexus/molecules/category-card.html" with
       category_name="Electronics"
       category_slug="electronics"
       listing_count=24
       icon="‚ö°"
       description="High-tech devices and gadgets"
       featured=true
    %}

    {% include "partials/nexus/molecules/category-card.html" with
       category_name="Resources"
       category_slug="resources"
       listing_count=18
       icon="üìö"
       description="Digital resources and guides"
    %}

    {% include "partials/nexus/molecules/category-card.html" with
       category_name="Services"
       category_slug="services"
       listing_count=32
       icon="üíº"
       description="Professional services"
    %}

    {% include "partials/nexus/molecules/category-card.html" with
       category_name="Collectibles"
       category_slug="collectibles"
       listing_count=15
       icon="üé®"
       description="Rare and unique items"
    %}

    {% include "partials/nexus/molecules/category-card.html" with
       category_name="Digital Art"
       category_slug="digital-art"
       listing_count=27
       icon="üñºÔ∏è"
       description="NFTs and digital artwork"
    %}

    {% include "partials/nexus/molecules/category-card.html" with
       category_name="Other"
       category_slug="other"
       listing_count=9
       icon="‚Ä¢‚Ä¢‚Ä¢"
       description="Miscellaneous items"
    %}
  </div>
</section>

{# Vendor CTA #}
{% if logged_in and role == "vendor" %}
<section style="max-width: 1400px; margin: 0 auto; padding: 0 var(--nexus-space-6) var(--nexus-space-8);">
  {% include "partials/nexus/atoms/button.html" with
     text="+ Create New Listing"
     href="/listings/new"
     variant="primary"
     size="lg"
  %}
</section>
{% endif %}

{# Featured Listings #}
<section style="max-width: 1400px; margin: 0 auto; padding: 0 var(--nexus-space-6) var(--nexus-space-12);">
  <h2 style="font-size: var(--nexus-text-3xl); font-weight: var(--nexus-weight-bold); color: var(--nexus-fg); margin-bottom: var(--nexus-space-8); text-align: center; text-transform: uppercase; letter-spacing: var(--nexus-tracking-wide);">
    Featured Listings
  </h2>

  <div id="listings-results" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: var(--nexus-space-6);">
    {% if listings and listings | length > 0 %}
      {% for listing in listings %}
        {% include "partials/nexus/molecules/product-card.html" with
           listing_id=listing.id
           title=listing.title
           price_xmr=listing.price_xmr
           vendor_name=listing.vendor_name | default(value="Anonymous")
           vendor_id=listing.vendor_id
           image_url=listing.first_image_cid
           category=listing.category
           rating=4
           review_count=12
           stock_status="in_stock"
           featured=loop.index <= 3
           glassmorphism=true
        %}
      {% endfor %}
    {% else %}
      {# Empty State #}
      <div style="grid-column: 1 / -1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: var(--nexus-space-20); text-align: center;">
        {% include "partials/nexus/molecules/skeleton.html" with
           variant="card"
           class="empty-state-skeleton"
        %}

        <div style="margin-top: var(--nexus-space-8);">
          {% include "partials/nexus/molecules/alert.html" with
             title="No Listings Available"
             message="There are no listings available at the moment. Check back soon or create the first one!"
             variant="info"
             dismissible=false
          %}
        </div>

        {% if logged_in and role == "vendor" %}
          <div style="margin-top: var(--nexus-space-6);">
            {% include "partials/nexus/atoms/button.html" with
               text="Create the First Listing"
               href="/listings/new"
               variant="primary"
               size="lg"
            %}
          </div>
        {% endif %}
      </div>
    {% endif %}
  </div>
</section>

{# Trust Indicators / Features Section #}
<section style="max-width: 1400px; margin: 0 auto; padding: var(--nexus-space-12) var(--nexus-space-6);">
  <h2 style="font-size: var(--nexus-text-3xl); font-weight: var(--nexus-weight-bold); color: var(--nexus-fg); margin-bottom: var(--nexus-space-8); text-align: center; text-transform: uppercase; letter-spacing: var(--nexus-tracking-wide);">
    Why Choose Nexus?
  </h2>

  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: var(--nexus-space-6);">
    {% include "partials/nexus/molecules/card.html" with
       title="üîí 2-of-3 Multisig Escrow"
       content="<p>Your funds are protected by Monero's advanced 2-of-3 multisig escrow. No single party can access the funds without consensus.</p>"
       variant="elevated"
       glassmorphism=true
       hover_effect="lift"
    %}

    {% include "partials/nexus/molecules/card.html" with
       title="üëª Complete Privacy"
       content="<p>All transactions use Monero (XMR) for untraceable, private payments. Your financial privacy is guaranteed.</p>"
       variant="elevated"
       glassmorphism=true
       hover_effect="lift"
    %}

    {% include "partials/nexus/molecules/card.html" with
       title="üïµÔ∏è Tor Network"
       content="<p>Access the marketplace through Tor for complete anonymity. Your identity and location remain private.</p>"
       variant="elevated"
       glassmorphism=true
       hover_effect="lift"
    %}

    {% include "partials/nexus/molecules/card.html" with
       title="‚öñÔ∏è Fair Dispute Resolution"
       content="<p>Neutral arbiters help resolve disputes fairly. The 2-of-3 multisig ensures consensus-based outcomes.</p>"
       variant="elevated"
       glassmorphism=true
       hover_effect="lift"
    %}
  </div>
</section>

{% endblock %}

{% block scripts %}
<script>
// Auto-refresh listings count every 30 seconds (optional)
setInterval(function() {
  // Could use HTMX to refresh stats
}, 30000);
</script>
{% endblock %}
