{% extends "base-nexus.html" %}

{% block title %}NEXUS — Anonymous Marketplace{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="/static/css/nexus-true.css">
<link rel="stylesheet" href="/static/css/hero-cinematic.css">
{% endblock %}

{% block content %}

{# TRUE NEXUS HERO - Full Screen with Animated Letters #}
<section class="nexus-hero-true">
  {# CINEMATIC: Flash blanc aveuglant (Phase 4) #}
  <div id="cinematic-flash" class="cinematic-flash-overlay"></div>

  {# Background Pattern - Grille de points noirs #}
  <div class="nexus-hero-pattern"></div>

  {# Animated Grid Lines #}
  <div class="nexus-hero-grid"></div>

  {# Floating Geometric Shapes #}
  <div class="nexus-floating-shape nexus-floating-shape-1"></div>
  <div class="nexus-floating-shape nexus-floating-shape-2"></div>
  <div class="nexus-floating-shape nexus-floating-shape-3"></div>

  {# Content #}
  <div class="nexus-hero-content-true">
    {# Top Text #}
    <div class="nexus-hero-top-text">
      ANONYMOUS • SECURE • DECENTRALIZED
    </div>

    {# CINEMATIC: Container pour 3 états (NEXUS / Typewriter / Zoom) #}
    <div id="cinematic-title-container" class="nexus-hero-title-true">

      {# Phase 1, 2, 5: NEXUS Letters #}
      <h1 id="cinematic-nexus-letters" class="cinematic-nexus-container">
        <span class="nexus-animated-letter" data-letter="N" role="button" tabindex="0" aria-label="Animate letter N">N</span>
        <span class="nexus-animated-letter nexus-letter-e" data-letter="E" role="button" tabindex="0" aria-label="Animate letter E">E</span>
        <span class="nexus-animated-letter" data-letter="X" role="button" tabindex="0" aria-label="Animate letter X">X</span>
        <span class="nexus-animated-letter" data-letter="U" role="button" tabindex="0" aria-label="Animate letter U">U</span>
        <span class="nexus-animated-letter" data-letter="S" role="button" tabindex="0" aria-label="Animate letter S">S</span>
      </h1>

      {# Phase 3: Typewriter - Message anonymat #}
      <div id="cinematic-typewriter" class="cinematic-typewriter" style="display: none;">
        <span id="cinematic-typewriter-text"></span>
        <span class="cinematic-cursor">|</span>
      </div>

      {# Phase 4: Zoom Strike - Même message qui frappe l'écran #}
      <div id="cinematic-zoom-strike" class="cinematic-zoom-strike" style="display: none;">
        Here you are no one. Here you are nowhere.
      </div>

    </div>

    {# Subtitle #}
    <p class="nexus-hero-subtitle-true">
      UNDERGROUND • MARKETPLACE
    </p>

    {# Stats #}
    <div class="nexus-hero-stats">
      <div class="nexus-hero-stat">
        <div class="nexus-hero-stat-value">{{ listings | length | default(value=1337) }}</div>
        <div class="nexus-hero-stat-label">LISTINGS</div>
      </div>
      <div class="nexus-hero-stat">
        <div class="nexus-hero-stat-value">420</div>
        <div class="nexus-hero-stat-label">VENDORS</div>
      </div>
      <div class="nexus-hero-stat">
        <div class="nexus-hero-stat-value">100%</div>
        <div class="nexus-hero-stat-label">ANONYMOUS</div>
      </div>
    </div>
  </div>

  {# Scroll Indicator #}
  <div class="nexus-scroll-indicator">
    <div class="nexus-scroll-text">SCROLL</div>
    <div class="nexus-scroll-line"></div>
  </div>
</section>

{# Browse Categories Section - NEXUS CHARTE #}
<section id="categories" class="nexus-categories-section">
  <div class="nexus-categories-container">
    <div class="nexus-categories-header">
      <h2 class="nexus-categories-title">BROWSE CATEGORIES</h2>
      <p class="nexus-categories-subtitle">SECURE • ANONYMOUS • UNTRACEABLE</p>
    </div>

    <div class="nexus-categories-grid">
      <!-- Digital Goods -->
      <a href="/categories/digital" class="nexus-category-box" hx-boost="true">
        <div class="nexus-category-box-icon">
          <svg class="nexus-icon nexus-icon-xl">
            <use href="/static/icons/nexus-icons.svg#icon-grid"></use>
          </svg>
        </div>
        <div class="nexus-category-box-info">
          <h3 class="nexus-category-box-title">DIGITAL GOODS</h3>
          <div class="nexus-category-box-count">342 ITEMS</div>
        </div>
      </a>

      <!-- Electronics -->
      <a href="/categories/electronics" class="nexus-category-box" hx-boost="true">
        <div class="nexus-category-box-icon">
          <svg class="nexus-icon nexus-icon-xl">
            <use href="/static/icons/nexus-icons.svg#icon-tag"></use>
          </svg>
        </div>
        <div class="nexus-category-box-info">
          <h3 class="nexus-category-box-title">ELECTRONICS</h3>
          <div class="nexus-category-box-count">156 ITEMS</div>
        </div>
      </a>

      <!-- Pharmaceuticals -->
      <a href="/categories/pharmaceuticals" class="nexus-category-box" hx-boost="true">
        <div class="nexus-category-box-icon">
          <svg class="nexus-icon nexus-icon-xl">
            <use href="/static/icons/nexus-icons.svg#icon-pill"></use>
          </svg>
        </div>
        <div class="nexus-category-box-info">
          <h3 class="nexus-category-box-title">PHARMACEUTICALS</h3>
          <div class="nexus-category-box-count">203 ITEMS</div>
        </div>
      </a>

      <!-- Documents -->
      <a href="/categories/documents" class="nexus-category-box" hx-boost="true">
        <div class="nexus-category-box-icon">
          <svg class="nexus-icon nexus-icon-xl">
            <use href="/static/icons/nexus-icons.svg#icon-file"></use>
          </svg>
        </div>
        <div class="nexus-category-box-info">
          <h3 class="nexus-category-box-title">DOCUMENTS</h3>
          <div class="nexus-category-box-count">89 ITEMS</div>
        </div>
      </a>

      <!-- Financial -->
      <a href="/categories/financial" class="nexus-category-box" hx-boost="true">
        <div class="nexus-category-box-icon">
          <svg class="nexus-icon nexus-icon-xl">
            <use href="/static/icons/nexus-icons.svg#icon-key"></use>
          </svg>
        </div>
        <div class="nexus-category-box-info">
          <h3 class="nexus-category-box-title">FINANCIAL</h3>
          <div class="nexus-category-box-count">127 ITEMS</div>
        </div>
      </a>

      <!-- Security -->
      <a href="/categories/security" class="nexus-category-box" hx-boost="true">
        <div class="nexus-category-box-icon">
          <svg class="nexus-icon nexus-icon-xl">
            <use href="/static/icons/nexus-icons.svg#icon-lock"></use>
          </svg>
        </div>
        <div class="nexus-category-box-info">
          <h3 class="nexus-category-box-title">SECURITY</h3>
          <div class="nexus-category-box-count">94 ITEMS</div>
        </div>
      </a>
    </div>
  </div>
</section>

{# Featured Listings Section - NEXUS CHARTE #}
<section id="listings" class="nexus-listings-section">
  <div class="nexus-listings-container">
    <div class="nexus-listings-header">
      <div class="nexus-listings-header-content">
        <h2 class="nexus-listings-title">
          FEATURED LISTINGS
        </h2>
        <p class="nexus-listings-subtitle">
          VERIFIED VENDORS • ESCROW PROTECTED
        </p>
      </div>
      <a href="/listings" class="nexus-btn nexus-btn-primary nexus-btn-lg nexus-listings-view-all-btn" hx-boost="true">
        VIEW ALL
      </a>
    </div>

  <div id="listings-results" class="nexus-listings-grid">
    {% if listings and listings | length > 0 %}
      {% for listing in listings %}
      <a href="/listings/{{ listing.id }}" class="nexus-product-link" hx-boost="true">
        <div class="nexus-product-card">
          {# Product Image with Gradient #}
          <div class="nexus-product-image">
            <div class="nexus-product-image-gradient"></div>
            {% if listing.first_image_cid %}
              <img src="http://127.0.0.1:8081/ipfs/{{ listing.first_image_cid }}"
                   alt="{{ listing.title }}"
                   class="nexus-product-image-actual"
                   onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
              <div class="nexus-product-image-placeholder" style="display: none;">?</div>
            {% else %}
              <div class="nexus-product-image-placeholder">?</div>
            {% endif %}

            {# Verified Badge (if listing is active/verified) #}
            {% if listing.status == "active" %}
            <div class="nexus-verified-badge">
              <svg class="nexus-verified-badge-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
              VERIFIED
            </div>
            {% endif %}
          </div>

          {# Product Content #}
          <div class="nexus-product-content">
            <div class="nexus-product-info">
              <h3 class="nexus-product-title">{{ listing.title }}</h3>
              <p class="nexus-product-vendor">BY {{ listing.vendor_username | upper }}</p>
            </div>

            {# Rating Stars #}
            <div class="nexus-product-rating">
              <div class="nexus-product-stars">
                {# 5 filled stars for now - can be dynamic later #}
                <svg class="nexus-product-star" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                <svg class="nexus-product-star" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                <svg class="nexus-product-star" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                <svg class="nexus-product-star" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                <svg class="nexus-product-star" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
              </div>
              <span class="nexus-product-rating-text">5/5</span>
            </div>

            {# Price and View Button #}
            <div class="nexus-product-footer">
              <div class="nexus-product-price-container">
                <div class="nexus-product-price">{{ listing.price_xmr }}</div>
                <div class="nexus-product-price-label">XMR</div>
              </div>
              <button class="nexus-product-view-btn">VIEW</button>
            </div>
          </div>
        </div>
      </a>
      {% endfor %}
    {% else %}
      {# Empty State #}
      <div class="nexus-listings-empty-state">
        <div class="nexus-alert nexus-alert-info">
          <div class="nexus-alert-icon">ℹ️</div>
          <div class="nexus-alert-content">
            <div class="nexus-alert-title">No listings yet</div>
            <div class="nexus-alert-message">
              Be the first to create a listing on the marketplace!
            </div>
          </div>
        </div>

        {% if logged_in and role == "vendor" %}
        <a href="/listings/create" class="nexus-btn nexus-btn-primary nexus-listings-empty-cta">
          Create Your First Listing
        </a>
        {% endif %}
      </div>
    {% endif %}
  </div>
  </div>
</section>

{# Stats Banner - Original Nexus Design #}
<section class="nexus-stats-banner">
  <div class="nexus-stats-container">
    <div class="nexus-stats-grid">
      <div class="nexus-stat-item">
        <div class="nexus-stat-value">24/7</div>
        <div class="nexus-stat-label">UPTIME</div>
      </div>
      <div class="nexus-stat-item">
        <div class="nexus-stat-value">0</div>
        <div class="nexus-stat-label">LOGS KEPT</div>
      </div>
      <div class="nexus-stat-item">
        <div class="nexus-stat-value">256</div>
        <div class="nexus-stat-label">BIT ENCRYPTION</div>
      </div>
      <div class="nexus-stat-item">
        <div class="nexus-stat-value">∞</div>
        <div class="nexus-stat-label">ANONYMITY</div>
      </div>
    </div>
  </div>
</section>

{% endblock %}

{% block scripts %}
<script src="/static/js/nexus-letters-animation.js"></script>
<script src="/static/js/hero-cinematic.js"></script>
<script src="/static/js/nexus-grid-magnetic.js"></script>
<script src="/static/js/nexus-diagonal-lines.js"></script>
{% endblock %}
