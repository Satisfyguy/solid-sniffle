<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings - NEXUS</title>
    <meta name="description" content="Manage your account settings and preferences on Nexus Marketplace.">
    <link rel="icon" href="/static/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="/static/css/main.css">
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <style>
        /* General Layout */
        .container { max-width: 1280px; margin: 0 auto; padding: 8rem 1.5rem 0; }
        .section { padding-top: 2rem; }
        .section-header { margin-bottom: 2rem; text-align: center; }
        .section-title { font-size: 2rem; font-weight: 700; color: hsl(var(--foreground)); text-transform: uppercase; letter-spacing: 0.1em; margin: 0; }
        .section-subtitle { margin-top: 0.5rem; color: hsl(var(--muted-foreground)); font-size: 0.875rem; }

        /* Card Component */
        .card {
            background-color: #242424;
            border: 1px solid var(--color-border);
            border-radius: 4px;
            color: var(--color-foreground);
            margin-bottom: 2rem;
            padding: 2rem;
        }
        .card-header {
            border-bottom: 1px solid hsl(var(--border));
            padding-bottom: 1rem;
            margin-bottom: 1.5rem;
        }
        .card-header h2 {
            font-size: 1.25rem;
            font-weight: 600;
            margin: 0;
        }
        .card-content {
            /* No specific styling, just a container */
        }

        /* Form Elements */
        .label {
            display: block;
            margin-bottom: 0.5rem;
            font-size: 0.75rem;
            font-weight: 600;
            color: hsl(var(--foreground));
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        .input {
            width: 100%;
            padding: 0.75rem 1rem;
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid var(--color-border);
            border-radius: 8px;
            color: var(--color-foreground);
            font-weight: 500;
            font-family: monospace;
            font-size: 0.875rem;
        }
        .small-text {
            display: block;
            margin-top: 0.5rem;
            font-size: 0.75rem;
            color: hsl(var(--muted-foreground));
        }

        /* Buttons */
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            text-decoration: none;
            display: inline-block;
            text-align: center;
            width: 100%;
            margin-top: 0.5rem;
            background-color: var(--color-accent);
            color: var(--color-background);
            border: none;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        .btn-primary {
            background-color: var(--color-accent);
            color: var(--color-background);
        }

        /* Specific styles for wallet address display */
        .wallet-address-display {
            padding: 1rem;
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.3);
            border-radius: 8px;
        }
        .wallet-address-display .label {
            color: hsl(142, 76%, 60%);
        }
        .wallet-address-display .address-text {
            font-family: monospace;
            font-size: 0.8125rem;
            color: hsl(142, 76%, 70%);
            word-break: break-all;
            line-height: 1.6;
        }

        .wallet-warning {
            padding: 1rem;
            background: rgba(234, 179, 8, 0.1);
            border: 1px solid rgba(234, 179, 8, 0.3);
            border-radius: 8px;
            display: flex;
            align-items: start;
            gap: 0.75rem;
        }
        .wallet-warning svg {
            flex-shrink: 0;
            margin-top: 0.125rem;
            stroke: hsl(45, 93%, 47%);
            width: 20px;
            height: 20px;
        }
        .wallet-warning strong {
            display: block;
            margin-bottom: 0.25rem;
            font-size: 0.875rem;
            color: hsl(45, 93%, 57%);
        }
        .wallet-warning small {
            color: hsl(45, 93%, 67%);
            font-size: 0.8125rem;
        }

        /* Htmx indicator */
        .htmx-indicator {
            margin-left: 0.5rem;
        }

        /* Loading spinner animation */
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top-color: currentColor;
            border-radius: 50%;
            animation: spin 0.6s linear infinite;
        }

        .htmx-request .spinner {
            display: inline-block;
        }

        .htmx-request .button-text {
            opacity: 0.6;
        }
    </style>
</head>
<body>
    {% include "header.html" %}

    <main class="container">
        <div class="section container" style="max-width: 800px;">
          {# Page Header #}
          <div class="section-header">
            <h1 class="section-title">‚öôÔ∏è Settings</h1>
            <p class="section-subtitle">Manage your account settings and preferences</p>
          </div>

          {# Account Information Card #}
          <div class="card">
            <div class="card-header">
              <h2>
                üë§ Account Information
              </h2>
            </div>

            <div class="card-content">
              <div style="display: grid; gap: 1rem;">
                <div>
                  <label class="label">
                    Username
                  </label>
                  <div class="input">
                    {{ username }}
                  </div>
                </div>

                <div>
                  <label class="label">
                    Role
                  </label>
                  <div class="input">
                    {% if role == "vendor" %}üè™ Vendor{% else %}üõí Buyer{% endif %}
                  </div>
                </div>
              </div>
            </div>
          </div>

          {# Wallet Configuration Card (Vendors only) #}
          {% if role == "vendor" %}
          <div class="card">
            <div class="card-header">
              <h2>
                üí∞ MONERO WALLET
              </h2>
              <p class="section-subtitle">
                Configure your Monero address to receive payments from completed orders
              </p>
            </div>

            <div class="card-content">
              <!-- Current Wallet Address Display (Updated via HTMX) -->
              <div id="wallet-result" style="margin-bottom: 1.5rem;">
                {% if wallet_address %}
                <div class="wallet-address-display">
                  <label class="label">
                    ‚úÖ Current Wallet Address
                  </label>
                  <div class="address-text">
                    {{ wallet_address }}
                  </div>
                </div>
                {% else %}
                <div class="wallet-warning">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"></path>
                    <line x1="12" y1="9" x2="12" y2="13"></line>
                    <line x1="12" y1="17" x2="12.01" y2="17"></line>
                  </svg>
                  <div>
                    <strong>
                      ‚ö†Ô∏è Wallet Address Not Configured
                    </strong>
                    <small>
                      You must configure your Monero wallet address before you can mark orders as shipped and receive payments.
                    </small>
                  </div>
                </div>
                {% endif %}
              </div>

              <form
                hx-post="/api/settings/update-wallet"
                hx-target="#wallet-result"
                hx-swap="innerHTML transition:true"
                hx-indicator=".htmx-indicator"
                hx-disabled-elt="find button[type='submit']"
                role="form"
                aria-label="Update wallet address form"
                style="display: flex; flex-direction: column; gap: 1.5rem;"
              >
                <!-- CSRF Token -->
                <input type="hidden" name="csrf_token" value="{{ csrf_token }}" aria-hidden="true">

                <!-- New Wallet Address Input -->
                <div>
                  <label for="wallet_address" class="label">
                    {% if wallet_address %}Update Wallet Address{% else %}Wallet Address{% endif %}
                    <span style="color: var(--color-accent);">*</span>
                  </label>
                  <input
                    type="text"
                    id="wallet_address"
                    name="wallet_address"
                    placeholder="4... or 8..."
                    required
                    minlength="95"
                    maxlength="106"
                    autocomplete="off"
                    aria-label="Your Monero wallet address"
                    aria-describedby="wallet-help"
                    class="input"
                    value=""
                  >
                  <small id="wallet-help" class="small-text">
                    Enter a valid Monero address (starts with 4 or 8, 95-106 characters). This is where you'll receive payments for completed orders.
                  </small>
                </div>

                <!-- Submit Button -->
                <button
                  type="submit"
                  class="btn btn-primary"
                  aria-label="Update wallet address"
                  hx-indicator=".spinner"
                >
                  <span class="button-text">
                    {% if wallet_address %}UPDATE WALLET ADDRESS{% else %}SAVE WALLET ADDRESS{% endif %}
                  </span>
                  <span class="spinner htmx-indicator" style="display: none; margin-left: 0.5rem;"></span>
                </button>
              </form>
            </div>
          </div>
          {% endif %}

        </div>
    </main>

    <script src="/static/js/lucide.min.js"></script>
    <script src="/static/js/base.js"></script>
    <script src="/static/js/notifications-nexus.js"></script>
    <script src="/static/js/settings.js"></script></body>
</html>