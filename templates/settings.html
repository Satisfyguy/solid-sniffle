{% extends "base-marketplace.html" %}

{% block title %}Settings - NEXUS{% endblock %}

{% block content %}

<div class="section container" style="padding-top: 2rem;">
  <div style="max-width: 800px; margin: 0 auto;">

    {# Page Header #}
    <div class="section-header">
      <h1 class="section-title">‚öôÔ∏è Settings</h1>
      <p class="section-subtitle">Manage your account settings and preferences</p>
    </div>

    {# Account Information Card #}
    <div class="card" style="margin-bottom: 2rem; padding: 2rem;">
      <div style="border-bottom: 1px solid hsl(var(--border)); padding-bottom: 1rem; margin-bottom: 1.5rem;">
        <h2 style="font-size: 1.25rem; font-weight: 600; margin: 0;">
          üë§ Account Information
        </h2>
      </div>

      <div class="nexus-card-content">
        <div style="display: grid; gap: 1rem;">
          <div>
            <label class="nexus-label" style="display: block; margin-bottom: 0.5rem; font-size: 0.75rem; font-weight: 600; color: var(--nexus-muted-fg, #9ca3af); text-transform: uppercase; letter-spacing: 0.05em;">
              Username
            </label>
            <div style="padding: 0.75rem 1rem; background: rgba(0, 0, 0, 0.2); border: 1px solid var(--nexus-glass-border, rgba(255, 255, 255, 0.1)); border-radius: 8px; color: var(--nexus-fg, #f9fafb); font-weight: 500;">
              {{ username }}
            </div>
          </div>

          <div>
            <label class="nexus-label" style="display: block; margin-bottom: 0.5rem; font-size: 0.75rem; font-weight: 600; color: var(--nexus-muted-fg, #9ca3af); text-transform: uppercase; letter-spacing: 0.05em;">
              Role
            </label>
            <div style="padding: 0.75rem 1rem; background: rgba(0, 0, 0, 0.2); border: 1px solid var(--nexus-glass-border, rgba(255, 255, 255, 0.1)); border-radius: 8px; color: var(--nexus-fg, #f9fafb); font-weight: 500;">
              {% if role == "vendor" %}üè™ Vendor{% else %}üõí Buyer{% endif %}
            </div>
          </div>
        </div>
      </div>
    </div>

    {# Wallet Configuration Card (Vendors only) #}
    {% if role == "vendor" %}
    <div class="nexus-card nexus-card-elevated nexus-card-glass">
      <div class="nexus-card-header" style="border-bottom: 1px solid var(--nexus-glass-border, rgba(255, 255, 255, 0.1)); padding-bottom: 1rem; margin-bottom: 1.5rem;">
        <h2 style="font-size: 1.25rem; font-weight: 600; color: var(--nexus-fg, #f9fafb); text-transform: uppercase; letter-spacing: 0.05em; margin: 0;">
          üí∞ MONERO WALLET
        </h2>
        <p style="margin-top: 0.5rem; color: var(--nexus-muted-fg, #9ca3af); font-size: 0.875rem;">
          Configure your Monero address to receive payments from completed orders
        </p>
      </div>

      <div class="nexus-card-content">
        <form
          hx-post="/api/settings/update-wallet"
          hx-target="#wallet-result"
          hx-swap="innerHTML"
          hx-indicator=".htmx-indicator"
          hx-disabled-elt="find button[type='submit']"
          role="form"
          aria-label="Update wallet address form"
          style="display: flex; flex-direction: column; gap: 1.5rem;"
        >
          <!-- CSRF Token -->
          <input type="hidden" name="csrf_token" value="{{ csrf_token }}" aria-hidden="true">

          <!-- Current Wallet Address (if set) -->
          {% if wallet_address %}
          <div style="padding: 1rem; background: rgba(34, 197, 94, 0.1); border: 1px solid rgba(34, 197, 94, 0.3); border-radius: 8px;">
            <label class="nexus-label" style="display: block; margin-bottom: 0.5rem; font-size: 0.75rem; font-weight: 600; color: hsl(142, 76%, 60%); text-transform: uppercase; letter-spacing: 0.05em;">
              ‚úÖ Current Wallet Address
            </label>
            <div style="font-family: monospace; font-size: 0.8125rem; color: hsl(142, 76%, 70%); word-break: break-all; line-height: 1.6;">
              {{ wallet_address }}
            </div>
          </div>
          {% else %}
          <div style="padding: 1rem; background: rgba(234, 179, 8, 0.1); border: 1px solid rgba(234, 179, 8, 0.3); border-radius: 8px; display: flex; align-items: start; gap: 0.75rem;">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="hsl(45, 93%, 47%)" stroke-width="2" style="flex-shrink: 0; margin-top: 0.125rem;">
              <path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"></path>
              <line x1="12" y1="9" x2="12" y2="13"></line>
              <line x1="12" y1="17" x2="12.01" y2="17"></line>
            </svg>
            <div>
              <strong style="display: block; margin-bottom: 0.25rem; font-size: 0.875rem; color: hsl(45, 93%, 57%);">
                ‚ö†Ô∏è Wallet Address Not Configured
              </strong>
              <small style="color: hsl(45, 93%, 67%); font-size: 0.8125rem;">
                You must configure your Monero wallet address before you can mark orders as shipped and receive payments.
              </small>
            </div>
          </div>
          {% endif %}

          <!-- New Wallet Address Input -->
          <div>
            <label for="wallet_address" class="nexus-label" style="display: block; margin-bottom: 0.5rem; font-size: 0.75rem; font-weight: 600; color: var(--nexus-fg, #f9fafb); text-transform: uppercase; letter-spacing: 0.05em;">
              {% if wallet_address %}Update Wallet Address{% else %}Wallet Address{% endif %}
              <span style="color: var(--nexus-primary, #ff1a5c);">*</span>
            </label>
            <input
              type="text"
              id="wallet_address"
              name="wallet_address"
              placeholder="4... or 8..."
              required
              minlength="95"
              maxlength="106"
              autocomplete="off"
              aria-label="Your Monero wallet address"
              aria-describedby="wallet-help"
              class="nexus-input"
              style="width: 100%; font-family: monospace; font-size: 0.875rem;"
              value=""
            >
            <small id="wallet-help" style="display: block; margin-top: 0.5rem; font-size: 0.75rem; color: var(--nexus-muted-fg, #9ca3af);">
              Enter a valid Monero address (starts with 4 or 8, 95-106 characters). This is where you'll receive payments for completed orders.
            </small>
          </div>

          <!-- Submit Button -->
          <button
            type="submit"
            class="nexus-btn nexus-btn-primary nexus-btn-lg"
            style="width: 100%; margin-top: 0.5rem;"
            aria-label="Update wallet address"
          >
            {% if wallet_address %}UPDATE WALLET ADDRESS{% else %}SAVE WALLET ADDRESS{% endif %}
            <span class="htmx-indicator" aria-hidden="true" style="margin-left: 0.5rem;">‚Üí</span>
          </button>
        </form>

        <!-- Response Container -->
        <div id="wallet-result" style="margin-top: 1.5rem;"></div>
      </div>
    </div>
    {% endif %}

  </div>
</div>

{% endblock %}

{% block scripts %}
<script src="/static/js/notifications-nexus.js"></script>
<script src="/static/js/settings.js"></script>
{% endblock %}
