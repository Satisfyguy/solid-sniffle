{% extends "base-nexus.html" %}

{% block title %}Wallet Settings — NEXUS{% endblock %}

{% block content %}

{# Breadcrumb #}
<section style="max-width: 1400px; margin: 0 auto; padding: var(--nexus-space-6) var(--nexus-space-6) 0;">
  {% include "partials/nexus/molecules/breadcrumb.html" %}
</section>

{# Main Content #}
<section style="max-width: 1400px; margin: 0 auto; padding: var(--nexus-space-6);">
  <div style="display: grid; grid-template-columns: 2fr 1fr; gap: var(--nexus-space-8);">

    {# Left Column - Main Form #}
    <div style="display: flex; flex-direction: column; gap: var(--nexus-space-6);">

      {# Header Card #}
      {% include "partials/nexus/molecules/card.html" %}

      {# Security Notice #}
      {% include "partials/nexus/molecules/alert.html" %}

      {# Registration Form #}
      {% include "partials/nexus/molecules/card.html" %}

      {# Security Features #}
      {% include "partials/nexus/molecules/card.html" %}

    </div>

    {# Right Column - Setup Instructions #}
    <div style="position: sticky; top: var(--nexus-space-6); align-self: start;">
      {% include "partials/nexus/molecules/card.html" %}
    </div>

  </div>
</section>

{% endblock %}

{% block scripts %}
<style>
/* HTMX indicator animation */
.htmx-indicator.htmx-request {
  display: flex !important;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* Select field focus state */
select:focus {
  outline: none;
  border-color: var(--nexus-primary) !important;
  box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
}

select:hover {
  border-color: var(--nexus-muted-fg);
}

/* Full width utility */
.w-full {
  width: 100%;
}

/* Responsive layout */
@media (max-width: 968px) {
  section > div[style*="grid-template-columns: 2fr 1fr"] {
    grid-template-columns: 1fr !important;
  }
}
</style>

<script>
// Handle HTMX response
document.body.addEventListener('htmx:afterRequest', function(event) {
  const walletResult = document.getElementById('wallet-result');

  if (event.detail.successful) {
    const xhr = event.detail.xhr;

    if (xhr.status === 200) {
      // Success
      walletResult.innerHTML = `
        <div style="padding: var(--nexus-space-4); background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.3); border-radius: var(--nexus-radius-md); color: var(--nexus-success); margin-top: var(--nexus-space-4);">
          ✓ Wallet RPC registered successfully!
        </div>
      `;
    }
  } else {
    // Error
    const xhr = event.detail.xhr;
    let errorMessage = 'Failed to register wallet RPC. Please check your settings.';

    try {
      const response = JSON.parse(xhr.responseText);
      if (response.error) {
        errorMessage = response.error;
      }
    } catch (e) {
      // Use default message
    }

    walletResult.innerHTML = `
      <div style="padding: var(--nexus-space-4); background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: var(--nexus-radius-md); color: var(--nexus-destructive); margin-top: var(--nexus-space-4);">
        ✗ ${errorMessage}
      </div>
    `;
  }
});
</script>
{% endblock %}
