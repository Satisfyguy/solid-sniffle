{% extends "base-nexus.html" %}
{% import "partials/nexus-macros.html" as nx %}

{% block title %}REGISTER ‚Äî NEXUS{% endblock %}

{% block content %}

{# Animated Background Orbs #}
<div class="nexus-hero-bg" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; pointer-events: none;">
  <div class="nexus-hero-bg-orb nexus-hero-bg-orb-1"></div>
  <div class="nexus-hero-bg-orb nexus-hero-bg-orb-2"></div>
  <div class="nexus-hero-bg-orb nexus-hero-bg-orb-3"></div>
</div>

{# Auth Container #}
<div style="position: relative; z-index: 1; min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 2rem;">
  <div class="nexus-card nexus-card-elevated nexus-card-glass" style="max-width: 520px; width: 100%;">
    <div class="nexus-card-header" style="text-align: center; border-bottom: 1px solid var(--nexus-glass-border, rgba(255, 255, 255, 0.1)); padding-bottom: 1.5rem; margin-bottom: 2rem;">
      <h1 style="font-size: 2rem; font-weight: 700; color: var(--nexus-fg, #f9fafb); text-transform: uppercase; letter-spacing: 0.1em; margin: 0;">
        CREATE ACCOUNT
      </h1>
      <p style="margin-top: 0.5rem; color: var(--nexus-muted-fg, #9ca3af); font-size: 0.875rem;">
        Join the secure Monero marketplace
      </p>
    </div>

    <div class="nexus-card-content">
      <form
        hx-post="/api/auth/register"
        hx-target="#auth-result"
        hx-swap="innerHTML"
        hx-indicator=".htmx-indicator"
        role="form"
        aria-label="Registration form"
        style="display: flex; flex-direction: column; gap: 1.5rem;"
      >
        <!-- CSRF Token -->
        <input type="hidden" name="csrf_token" value="{{ csrf_token }}" aria-hidden="true">

        <!-- Username Field -->
        <div>
          <label for="username" class="nexus-label" style="display: block; margin-bottom: 0.5rem; font-size: 0.75rem; font-weight: 600; color: var(--nexus-fg, #f9fafb); text-transform: uppercase; letter-spacing: 0.05em;">
            Username
          </label>
          <input
            type="text"
            id="username"
            name="username"
            placeholder="Choose a username"
            required
            minlength="3"
            maxlength="50"
            autocomplete="username"
            aria-label="Choose your username"
            aria-required="true"
            aria-describedby="username-help"
            class="nexus-input"
            style="width: 100%;"
          >
          <small id="username-help" style="display: block; margin-top: 0.5rem; font-size: 0.75rem; color: var(--nexus-muted-fg, #9ca3af);">
            3-50 characters
          </small>
        </div>

        <!-- Password Field -->
        <div>
          <label for="password" class="nexus-label" style="display: block; margin-bottom: 0.5rem; font-size: 0.75rem; font-weight: 600; color: var(--nexus-fg, #f9fafb); text-transform: uppercase; letter-spacing: 0.05em;">
            Password
          </label>
          <input
            type="password"
            id="password"
            name="password"
            placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
            required
            minlength="8"
            autocomplete="new-password"
            aria-label="Choose your password"
            aria-required="true"
            aria-describedby="password-help"
            class="nexus-input"
            style="width: 100%;"
          >
          <small id="password-help" style="display: block; margin-top: 0.5rem; font-size: 0.75rem; color: var(--nexus-muted-fg, #9ca3af);">
            Minimum 8 characters
          </small>
        </div>

        <!-- Role Field -->
        <div>
          <label for="role" class="nexus-label" style="display: block; margin-bottom: 0.5rem; font-size: 0.75rem; font-weight: 600; color: var(--nexus-fg, #f9fafb); text-transform: uppercase; letter-spacing: 0.05em;">
            Role
          </label>
          <select
            id="role"
            name="role"
            required
            aria-label="Select your role"
            aria-required="true"
            class="nexus-select"
            style="width: 100%;"
          >
            <option value="">‚Äî Select Role ‚Äî</option>
            <option value="buyer">üõí Buyer</option>
            <option value="vendor">üè™ Vendor</option>
          </select>
          <small style="display: block; margin-top: 0.5rem; font-size: 0.75rem; color: var(--nexus-muted-fg, #9ca3af);">
            Choose buyer to purchase or vendor to sell
          </small>
        </div>

        <!-- Submit Button -->
        <button
          type="submit"
          class="nexus-btn nexus-btn-primary nexus-btn-lg"
          style="width: 100%; margin-top: 0.5rem;"
          aria-label="Submit registration form"
        >
          REGISTER <span class="htmx-indicator" aria-hidden="true" style="margin-left: 0.5rem;">‚Üí</span>
        </button>
      </form>

      <!-- Response Container -->
      <div id="auth-result" style="margin-top: 1.5rem;"></div>

      <!-- Login Link -->
      <div style="margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid var(--nexus-glass-border, rgba(255, 255, 255, 0.1)); text-align: center;">
        <p style="color: var(--nexus-muted-fg, #9ca3af); font-size: 0.875rem; margin: 0;">
          Have an account?
          <a
            href="/login"
            hx-boost="true"
            style="color: var(--nexus-primary, #ff1a5c); text-decoration: none; font-weight: 600; margin-left: 0.25rem; transition: all 0.2s ease;"
            onmouseover="this.style.textShadow='0 0 10px var(--nexus-primary)'"
            onmouseout="this.style.textShadow='none'"
          >
            Login Here
          </a>
        </p>
      </div>
    </div>
  </div>
</div>

{% endblock %}

{% block scripts %}
<script>
// Handle HTMX response
document.body.addEventListener('htmx:afterRequest', function(event) {
  if (event.detail.pathInfo.requestPath === '/api/auth/register') {
    const resultDiv = document.getElementById('auth-result');

    if (event.detail.successful) {
      // Success - redirect will happen automatically
      resultDiv.innerHTML = `
        <div class="nexus-alert nexus-alert-success">
          <div class="nexus-alert-icon">‚úì</div>
          <div class="nexus-alert-content">
            <div class="nexus-alert-title">Registration Successful</div>
            <div class="nexus-alert-message">Account created! Redirecting to login...</div>
          </div>
        </div>
      `;
    } else {
      // Error handling
      resultDiv.innerHTML = `
        <div class="nexus-alert nexus-alert-error">
          <div class="nexus-alert-icon">‚úï</div>
          <div class="nexus-alert-content">
            <div class="nexus-alert-title">Registration Failed</div>
            <div class="nexus-alert-message">Username may already exist or invalid input.</div>
          </div>
        </div>
      `;
    }
  }
});
</script>
{% endblock %}
