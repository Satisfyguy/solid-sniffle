{% extends "base-marketplace.html" %}

{% block title %}Login - NEXUS{% endblock %}

{% block content %}

<div class="min-h-screen flex items-center justify-center bg-gradient-to-br from-primary/5 via-background to-accent/5 p-4">
    <div style="width: 100%; max-width: 480px;">
        <!-- Logo -->
        <a href="/" class="flex items-center justify-center gap-2 mb-8 group">
            <svg class="lucide" viewBox="0 0 24 24" style="width: 32px; height: 32px; color: hsl(var(--primary));" class="group-hover:scale-110 transition-transform">
                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10"/>
            </svg>
            <span style="font-size: 1.875rem; font-weight: 700;">NEXUS</span>
        </a>

        <div class="card shadow-2xl" style="padding: 2rem;">
            <!-- Tabs Login/SignUp -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.25rem; padding: 0.25rem; background-color: hsl(var(--muted)); border-radius: 0.5rem; margin-bottom: 2rem;">
                <button type="button" id="tab-login" class="auth-tab-btn active" data-tab="login" style="padding: 0.75rem 1rem; border-radius: 0.375rem; transition: all 0.2s; font-weight: 500; font-size: 0.875rem; border: none; cursor: pointer;">
                    Login
                </button>
                <button type="button" id="tab-signup" class="auth-tab-btn" data-tab="signup" style="padding: 0.75rem 1rem; border-radius: 0.375rem; transition: all 0.2s; font-weight: 500; font-size: 0.875rem; border: none; cursor: pointer;">
                    Sign Up
                </button>
            </div>

            <!-- Login Form -->
            <div id="content-login" class="auth-content" style="display: block;">
                <form hx-post="/api/auth/login" hx-target="body" class="space-y-6">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token }}">

                    <div class="space-y-2">
                        <label for="login-username" class="text-sm font-medium">Username</label>
                        <input id="login-username" name="username" type="text" placeholder="Your username" style="border-width: 2px; height: 3rem;" class="flex w-full rounded-md border border-input bg-background px-3 py-2 text-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary" required minlength="3" />
                    </div>

                    <div class="space-y-2">
                        <label for="login-password" class="text-sm font-medium">Password</label>
                        <div style="position: relative;">
                            <input id="login-password" name="password" type="password" placeholder="••••••••" style="border-width: 2px; padding-right: 2.5rem; height: 3rem;" class="flex w-full rounded-md border border-input bg-background px-3 py-2 text-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary" required minlength="8" />
                            <button type="button" class="password-toggle" data-target="login-password" style="position: absolute; right: 0.75rem; top: 50%; transform: translateY(-50%); background: none; border: none; color: hsl(var(--muted-foreground)); cursor: pointer;">
                                <svg class="eye-icon" viewBox="0 0 24 24" style="width: 16px; height: 16px;" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                                    <circle cx="12" cy="12" r="3"/>
                                </svg>
                            </button>
                        </div>
                    </div>

                    <div class="flex items-center justify-between text-sm">
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="checkbox" name="remember" style="border-width: 2px;" class="rounded">
                            <span>Remember me</span>
                        </label>
                    </div>

                    <button type="submit" class="btn btn-primary w-full btn-lg">Login</button>
                </form>
            </div>

            <!-- Signup Form -->
            <div id="content-signup" class="auth-content" style="display: none;">
                <form hx-post="/api/auth/register" hx-target="body" class="space-y-6">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token }}">

                    <div class="space-y-2">
                        <label for="signup-username" class="text-sm font-medium">Username</label>
                        <input id="signup-username" name="username" type="text" placeholder="Choose a username" minlength="3" maxlength="50" style="border-width: 2px; height: 3rem;" class="flex w-full rounded-md border border-input bg-background px-3 py-2 text-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary" required />
                        <p class="text-xs text-muted-foreground">3-50 characters, no email needed</p>
                    </div>

                    <div class="space-y-2">
                        <label for="signup-password" class="text-sm font-medium">Password</label>
                        <div style="position: relative;">
                            <input id="signup-password" name="password" type="password" placeholder="Create a strong password" minlength="8" style="border-width: 2px; padding-right: 2.5rem; height: 3rem;" class="flex w-full rounded-md border border-input bg-background px-3 py-2 text-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary" required />
                            <button type="button" class="password-toggle" data-target="signup-password" style="position: absolute; right: 0.75rem; top: 50%; transform: translateY(-50%); background: none; border: none; color: hsl(var(--muted-foreground)); cursor: pointer;">
                                <svg class="eye-icon" viewBox="0 0 24 24" style="width: 16px; height: 16px;" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                                    <circle cx="12" cy="12" r="3"/>
                                </svg>
                            </button>
                        </div>
                        <p class="text-xs text-muted-foreground">Must be at least 8 characters</p>
                    </div>

                    <!-- Account Type Tabs -->
                    <div class="space-y-2">
                        <label class="text-sm font-medium">Account Type</label>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.25rem; padding: 0.25rem; background-color: hsl(var(--muted)); border-radius: 0.5rem;">
                            <button type="button" id="role-buyer" class="role-tab-btn active" data-role="buyer" style="padding: 0.75rem 1rem; border-radius: 0.375rem; transition: all 0.2s; font-weight: 500; font-size: 0.875rem; border: none; cursor: pointer;">
                                Buyer
                            </button>
                            <button type="button" id="role-seller" class="role-tab-btn" data-role="vendor" style="padding: 0.75rem 1rem; border-radius: 0.375rem; transition: all 0.2s; font-weight: 500; font-size: 0.875rem; border: none; cursor: pointer;">
                                Seller
                            </button>
                        </div>
                        <input type="hidden" id="role-input" name="role" value="buyer" />
                    </div>

                    <!-- Monero Wallet (Seller only) -->
                    <div id="wallet-field" class="space-y-2" style="display: none;">
                        <label for="wallet-address" class="text-sm font-medium">Monero Wallet Address <span class="text-muted-foreground font-normal">(Optional)</span></label>
                        <input id="wallet-address" name="wallet_address" type="text" placeholder="4... (Primary address)" style="border-width: 2px; height: 3rem;" class="flex w-full rounded-md border border-input bg-background px-3 py-2 text-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary font-mono" disabled />
                        <p class="text-xs text-muted-foreground">You can add this later in settings. Required to receive payments.</p>
                    </div>

                    <button type="submit" class="btn btn-primary w-full btn-lg">Create Account</button>
                </form>
            </div>

            <!-- Privacy Notice -->
            <div style="margin-top: 1.5rem; padding: 1rem; background-color: hsl(var(--secondary) / 0.5); border-radius: 0.5rem;">
                <p class="text-xs text-center text-muted-foreground" style="display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                    <svg viewBox="0 0 24 24" style="width: 16px; height: 16px; color: hsl(var(--primary));" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10"/>
                    </svg>
                    Your privacy is our priority. All accounts are anonymous and secure.
                </p>
            </div>
        </div>

        <p class="text-center text-sm text-muted-foreground" style="margin-top: 1.5rem;">
            <a href="/" class="text-primary hover:underline">← Back to Home</a>
        </p>
    </div>
</div>

<style>
/* Auth Tab Buttons - More Visible & Darker */
.auth-tab-btn {
    background-color: transparent;
    color: hsl(var(--muted-foreground));
}
.auth-tab-btn.active {
    background-color: hsl(var(--primary));
    color: hsl(var(--primary-foreground));
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}
.auth-tab-btn:hover {
    background-color: hsl(var(--primary) / 0.8);
    color: hsl(var(--primary-foreground));
}

/* Role Tab Buttons - Darker & More Visible */
.role-tab-btn {
    background-color: transparent;
    color: hsl(var(--muted-foreground));
}
.role-tab-btn.active {
    background-color: hsl(var(--primary));
    color: hsl(var(--primary-foreground));
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}
.role-tab-btn:hover {
    background-color: hsl(var(--primary) / 0.8);
    color: hsl(var(--primary-foreground));
}

.auth-content {
    animation: fadeIn 0.3s ease-in-out;
}
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}
</style>

{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Auth Tabs (Login/SignUp)
    const loginBtn = document.getElementById('tab-login');
    const signupBtn = document.getElementById('tab-signup');
    const loginContent = document.getElementById('content-login');
    const signupContent = document.getElementById('content-signup');

    loginBtn.addEventListener('click', function() {
        loginBtn.classList.add('active');
        signupBtn.classList.remove('active');
        loginContent.style.display = 'block';
        signupContent.style.display = 'none';
    });

    signupBtn.addEventListener('click', function() {
        signupBtn.classList.add('active');
        loginBtn.classList.remove('active');
        signupContent.style.display = 'block';
        loginContent.style.display = 'none';
    });

    // Role Tabs (Buyer/Seller)
    const buyerBtn = document.getElementById('role-buyer');
    const sellerBtn = document.getElementById('role-seller');
    const roleInput = document.getElementById('role-input');
    const walletField = document.getElementById('wallet-field');
    const walletInput = document.getElementById('wallet-address');

    buyerBtn.addEventListener('click', function() {
        buyerBtn.classList.add('active');
        sellerBtn.classList.remove('active');
        roleInput.value = 'buyer';
        walletField.style.display = 'none';
        walletInput.disabled = true;
    });

    sellerBtn.addEventListener('click', function() {
        sellerBtn.classList.add('active');
        buyerBtn.classList.remove('active');
        roleInput.value = 'vendor';
        walletField.style.display = 'block';
        walletInput.disabled = false;
    });

    // Password Toggle
    const passwordToggles = document.querySelectorAll('.password-toggle');
    passwordToggles.forEach(function(toggle) {
        toggle.addEventListener('click', function() {
            const targetId = this.getAttribute('data-target');
            const input = document.getElementById(targetId);
            const icon = this.querySelector('.eye-icon');
            
            if (input.type === 'password') {
                input.type = 'text';
                icon.innerHTML = '<path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/><line x1="1" y1="1" x2="23" y2="23"/>';
            } else {
                input.type = 'password';
                icon.innerHTML = '<path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/>';
            }
        });
    });
});
</script>
{% endblock %}
