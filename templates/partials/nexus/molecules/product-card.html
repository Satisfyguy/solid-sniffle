{#
  NEXUS PRODUCT CARD COMPONENT

  Usage:
    {% include "partials/nexus/molecules/product-card.html" with
       listing_id="abc123"
       title="Premium Product"
       price_xmr=1500000000000
       vendor_name="TrustedVendor"
       image_url="/static/uploads/product.jpg"
    %}

  Parameters:
    - listing_id (required): Listing ID for link
    - title (required): Product title
    - price_xmr (required): Price in atomic XMR (piconeros)
    - vendor_name (required): Vendor display name
    - vendor_id (optional): Vendor ID for link
    - image_url (optional): Product image URL
    - category (optional): Category name
    - rating (optional): Rating 1-5
    - review_count (optional): Number of reviews
    - stock_status (optional): in_stock|low_stock|out_of_stock
    - featured (optional): true|false - Featured product (default: false)
    - glassmorphism (optional): true|false - Apply glass effect (default: true)
    - class (optional): Additional CSS classes
#}

{% set product_featured = featured | default(value=false) %}
{% set product_glassmorphism = glassmorphism | default(value=true) %}
{% set product_stock_status = stock_status | default(value="in_stock") %}

{# Calculate XMR display value (divide by 10^12) #}
{% set xmr_value = price_xmr / 1000000000000 %}

{# Build CSS classes #}
{% set css_classes = "nexus-product-card" %}
{% if product_glassmorphism %}
  {% set css_classes = css_classes ~ " nexus-product-card-glass" %}
{% endif %}
{% if product_featured %}
  {% set css_classes = css_classes ~ " nexus-product-card-featured" %}
{% endif %}
{% if class %}
  {% set css_classes = css_classes ~ " " ~ class %}
{% endif %}

<div class="{{ css_classes }}">
  {# Product Link Wrapper #}
  <a href="/listing/{{ listing_id }}" class="nexus-product-card-link" hx-boost="true">
    {# Image Container #}
    <div class="nexus-product-card-image">
      {% if image_url %}
        <img src="{{ image_url }}" alt="{{ title }}" loading="lazy">
      {% else %}
        <div class="nexus-product-card-image-placeholder">
          <span>ðŸ“¦</span>
        </div>
      {% endif %}

      {# Featured Badge #}
      {% if product_featured %}
        <div class="nexus-product-card-badge-featured">
          {% include "partials/nexus/atoms/badge.html" with
             text="Featured"
             variant="primary"
          %}
        </div>
      {% endif %}

      {# Stock Status Badge #}
      {% if product_stock_status == "low_stock" %}
        <div class="nexus-product-card-badge-stock">
          {% include "partials/nexus/atoms/badge.html" with
             text="Low Stock"
             variant="warning"
          %}
        </div>
      {% elif product_stock_status == "out_of_stock" %}
        <div class="nexus-product-card-badge-stock">
          {% include "partials/nexus/atoms/badge.html" with
             text="Out of Stock"
             variant="destructive"
          %}
        </div>
      {% endif %}
    </div>

    {# Content #}
    <div class="nexus-product-card-content">
      {# Category (if provided) #}
      {% if category %}
        <div class="nexus-product-card-category">
          {% include "partials/nexus/atoms/badge.html" with
             text=category
             variant="secondary"
             size="sm"
          %}
        </div>
      {% endif %}

      {# Title #}
      <h3 class="nexus-product-card-title">{{ title }}</h3>

      {# Rating (if provided) #}
      {% if rating %}
        <div class="nexus-product-card-rating">
          <span class="nexus-product-card-rating-stars">
            {% for i in range(end=5) %}
              {% if i < rating %}
                <span class="nexus-product-card-star-filled">â˜…</span>
              {% else %}
                <span class="nexus-product-card-star-empty">â˜†</span>
              {% endif %}
            {% endfor %}
          </span>
          {% if review_count %}
            <span class="nexus-product-card-rating-count">({{ review_count }})</span>
          {% endif %}
        </div>
      {% endif %}

      {# Price #}
      <div class="nexus-product-card-price">
        <span class="nexus-product-card-price-value">{{ xmr_value }}</span>
        <span class="nexus-product-card-price-currency">XMR</span>
      </div>

      {# Vendor #}
      <div class="nexus-product-card-vendor">
        <span class="nexus-product-card-vendor-label">by</span>
        {% if vendor_id %}
          <a href="/vendor/{{ vendor_id }}" class="nexus-product-card-vendor-link" onclick="event.stopPropagation();">
            {{ vendor_name }}
          </a>
        {% else %}
          <span class="nexus-product-card-vendor-name">{{ vendor_name }}</span>
        {% endif %}
      </div>
    </div>
  </a>

  {# Quick Action Button #}
  <div class="nexus-product-card-actions">
    {% include "partials/nexus/atoms/button.html" with
       text="View Details"
       variant="outline"
       size="sm"
       href="/listing/" ~ listing_id
       class="nexus-product-card-action-btn"
    %}
  </div>
</div>

<style>
/* Base Product Card */
.nexus-product-card {
  display: flex;
  flex-direction: column;
  background-color: var(--nexus-card);
  border: 1px solid var(--nexus-border);
  border-radius: var(--nexus-radius-lg);
  overflow: hidden;
  transition: all var(--nexus-transition-base) var(--nexus-ease-out);
  height: 100%;
}

.nexus-product-card:hover {
  transform: translateY(-4px);
  box-shadow: var(--nexus-shadow-lg);
  border-color: var(--nexus-primary);
}

/* Glassmorphism Effect */
.nexus-product-card-glass {
  background: rgba(255, 255, 255, 0.05);
  backdrop-filter: blur(20px) saturate(180%);
  -webkit-backdrop-filter: blur(20px) saturate(180%);
  border: 1px solid rgba(255, 255, 255, 0.1);
  box-shadow:
    0 8px 32px 0 rgba(0, 0, 0, 0.37),
    inset 0 1px 0 0 rgba(255, 255, 255, 0.1);
}

/* Featured Product */
.nexus-product-card-featured {
  border: 2px solid var(--nexus-primary);
  box-shadow: var(--nexus-glow-primary);
}

.nexus-product-card-featured:hover {
  box-shadow:
    var(--nexus-glow-primary),
    var(--nexus-shadow-xl);
}

/* Product Link (covers image and content) */
.nexus-product-card-link {
  display: flex;
  flex-direction: column;
  flex: 1;
  text-decoration: none;
  color: inherit;
  cursor: pointer;
}

/* Image Container */
.nexus-product-card-image {
  position: relative;
  width: 100%;
  height: 220px;
  background-color: var(--nexus-muted);
  overflow: hidden;
}

.nexus-product-card-image img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  transition: transform var(--nexus-transition-base) var(--nexus-ease-out);
}

.nexus-product-card:hover .nexus-product-card-image img {
  transform: scale(1.1);
}

.nexus-product-card-image-placeholder {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 100%;
  height: 100%;
  font-size: 4rem;
  background: linear-gradient(135deg, var(--nexus-muted) 0%, var(--nexus-bg) 100%);
}

/* Badges */
.nexus-product-card-badge-featured {
  position: absolute;
  top: var(--nexus-space-3);
  left: var(--nexus-space-3);
  z-index: 10;
}

.nexus-product-card-badge-stock {
  position: absolute;
  top: var(--nexus-space-3);
  right: var(--nexus-space-3);
  z-index: 10;
}

/* Content */
.nexus-product-card-content {
  padding: var(--nexus-space-4);
  display: flex;
  flex-direction: column;
  gap: var(--nexus-space-2);
  flex: 1;
}

/* Category */
.nexus-product-card-category {
  display: flex;
}

/* Title */
.nexus-product-card-title {
  font-size: var(--nexus-text-lg);
  font-weight: var(--nexus-weight-bold);
  color: var(--nexus-fg);
  margin: 0;
  line-height: var(--nexus-leading-tight);
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* Rating */
.nexus-product-card-rating {
  display: flex;
  align-items: center;
  gap: var(--nexus-space-2);
  font-size: var(--nexus-text-sm);
}

.nexus-product-card-rating-stars {
  color: var(--nexus-warning);
  letter-spacing: 2px;
}

.nexus-product-card-star-filled {
  color: var(--nexus-warning);
}

.nexus-product-card-star-empty {
  color: var(--nexus-muted-fg);
}

.nexus-product-card-rating-count {
  color: var(--nexus-muted-fg);
}

/* Price */
.nexus-product-card-price {
  display: flex;
  align-items: baseline;
  gap: var(--nexus-space-2);
  margin-top: auto;
}

.nexus-product-card-price-value {
  font-size: var(--nexus-text-2xl);
  font-weight: var(--nexus-weight-bold);
  color: var(--nexus-primary);
  line-height: 1;
}

.nexus-product-card-price-currency {
  font-size: var(--nexus-text-sm);
  font-weight: var(--nexus-weight-medium);
  color: var(--nexus-muted-fg);
  text-transform: uppercase;
  letter-spacing: var(--nexus-tracking-wide);
}

/* Vendor */
.nexus-product-card-vendor {
  display: flex;
  align-items: center;
  gap: var(--nexus-space-1);
  font-size: var(--nexus-text-sm);
  color: var(--nexus-muted-fg);
}

.nexus-product-card-vendor-label {
  font-style: italic;
}

.nexus-product-card-vendor-link {
  color: var(--nexus-primary);
  text-decoration: none;
  font-weight: var(--nexus-weight-medium);
  transition: color var(--nexus-transition-base) var(--nexus-ease-out);
}

.nexus-product-card-vendor-link:hover {
  color: var(--nexus-primary-hover);
  text-decoration: underline;
}

.nexus-product-card-vendor-name {
  font-weight: var(--nexus-weight-medium);
  color: var(--nexus-fg);
}

/* Actions */
.nexus-product-card-actions {
  padding: var(--nexus-space-3);
  padding-top: 0;
  display: flex;
  gap: var(--nexus-space-2);
}

.nexus-product-card-action-btn {
  width: 100%;
}

/* Responsive */
@media (max-width: 768px) {
  .nexus-product-card-image {
    height: 180px;
  }

  .nexus-product-card-content {
    padding: var(--nexus-space-3);
  }

  .nexus-product-card-title {
    font-size: var(--nexus-text-base);
  }

  .nexus-product-card-price-value {
    font-size: var(--nexus-text-xl);
  }
}
</style>
