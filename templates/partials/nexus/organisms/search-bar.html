{#
  NEXUS SEARCH BAR COMPONENT

  Usage:
    {% include "partials/nexus/organisms/search-bar.html" with
       placeholder="Search listings..."
       action="/search"
    %}

  Parameters:
    - placeholder (optional): Search input placeholder (default: "Search...")
    - action (optional): Form action URL (default: "/search")
    - method (optional): Form method (default: "get")
    - name (optional): Input name (default: "q")
    - filters (optional): true|false - Show filter dropdown (default: false)
    - hx_get (optional): HTMX GET endpoint for live search
    - hx_target (optional): HTMX target for results
    - class (optional): Additional CSS classes
#}

{% set search_placeholder = placeholder | default(value="Search...") %}
{% set search_action = action | default(value="/search") %}
{% set search_method = method | default(value="get") %}
{% set search_name = name | default(value="q") %}
{% set search_filters = filters | default(value=false) %}

{# Build CSS classes #}
{% set css_classes = "nexus-search-bar" %}
{% if class %}
  {% set css_classes = css_classes ~ " " ~ class %}
{% endif %}

<form
  class="{{ css_classes }}"
  action="{{ search_action }}"
  method="{{ search_method }}"
  {% if hx_get %}hx-get="{{ hx_get }}"{% endif %}
  {% if hx_target %}hx-target="{{ hx_target }}"{% endif %}
  {% if hx_get %}hx-trigger="input changed delay:300ms from:#search-input"{% endif %}
>
  {# Search Input Container #}
  <div class="nexus-search-input-wrapper">
    <span class="nexus-search-icon">üîç</span>
    <input
      type="search"
      id="search-input"
      name="{{ search_name }}"
      placeholder="{{ search_placeholder }}"
      class="nexus-search-input"
      autocomplete="off"
    >
    {% if search_filters %}
      {% include "partials/nexus/molecules/dropdown-menu.html" with
         id="search-filters"
         trigger_icon="‚öôÔ∏è"
         trigger_variant="ghost"
         position="bottom-end"
         items=[
           {"text": "All Categories", "href": "?category=all"},
           {"separator": true},
           {"text": "Electronics", "href": "?category=electronics"},
           {"text": "Books", "href": "?category=books"},
           {"text": "Clothing", "href": "?category=clothing"}
         ]
      %}
    {% endif %}
  </div>

  {# Search Button #}
  <button type="submit" class="nexus-search-btn" aria-label="Search">
    Search
  </button>
</form>

<style>
/* Base Search Bar */
.nexus-search-bar {
  display: flex;
  align-items: center;
  gap: var(--nexus-space-2);
  width: 100%;
  max-width: 600px;
}

/* Search Input Wrapper */
.nexus-search-input-wrapper {
  position: relative;
  flex: 1;
  display: flex;
  align-items: center;
  background-color: var(--nexus-input);
  border: 1px solid var(--nexus-border);
  border-radius: var(--nexus-radius-md);
  overflow: hidden;
  transition: all var(--nexus-transition-base) var(--nexus-ease-out);
}

.nexus-search-input-wrapper:focus-within {
  border-color: var(--nexus-ring);
  box-shadow: 0 0 0 3px rgba(255, 26, 92, 0.1);
}

/* Search Icon */
.nexus-search-icon {
  position: absolute;
  left: var(--nexus-space-3);
  font-size: var(--nexus-text-lg);
  color: var(--nexus-muted-fg);
  pointer-events: none;
}

/* Search Input */
.nexus-search-input {
  flex: 1;
  padding: var(--nexus-space-3) var(--nexus-space-3) var(--nexus-space-3) var(--nexus-space-10);
  font-size: var(--nexus-text-base);
  color: var(--nexus-fg);
  background: none;
  border: none;
  outline: none;
}

.nexus-search-input::placeholder {
  color: var(--nexus-muted-fg);
}

/* Search Button */
.nexus-search-btn {
  padding: var(--nexus-space-3) var(--nexus-space-6);
  font-size: var(--nexus-text-sm);
  font-weight: var(--nexus-weight-bold);
  text-transform: uppercase;
  color: var(--nexus-primary-fg);
  background-color: var(--nexus-primary);
  border: none;
  border-radius: var(--nexus-radius-md);
  cursor: pointer;
  transition: all var(--nexus-transition-base) var(--nexus-ease-out);
  white-space: nowrap;
}

.nexus-search-btn:hover {
  background-color: var(--nexus-primary-hover);
  box-shadow: var(--nexus-glow-primary);
}

.nexus-search-btn:focus {
  outline: 2px solid var(--nexus-ring);
  outline-offset: 2px;
}

/* Responsive */
@media (max-width: 768px) {
  .nexus-search-bar {
    max-width: 100%;
  }

  .nexus-search-input {
    padding: var(--nexus-space-2) var(--nexus-space-2) var(--nexus-space-2) var(--nexus-space-9);
    font-size: var(--nexus-text-sm);
  }

  .nexus-search-btn {
    padding: var(--nexus-space-2) var(--nexus-space-4);
    font-size: var(--nexus-text-xs);
  }

  .nexus-search-icon {
    left: var(--nexus-space-2);
    font-size: var(--nexus-text-base);
  }
}
</style>
