# üèóÔ∏è Proposition de Restructuration du Projet

**Date:** 2025-10-26  
**Version Actuelle:** v4.0  
**Objectif:** Structure Rust professionnelle et maintenable

---

## üìä ANALYSE DE LA STRUCTURE ACTUELLE

### ‚ùå Probl√®mes Identifi√©s

1. **Racine encombr√©e** - 80+ fichiers markdown √† la racine
2. **Dossiers temporaires** - `4.5/`, `4.s/`, `archive/`, `venv/`
3. **Binaires dans git** - `buyer`, `linux64`, `monero-x86_64-linux-gnu-v0.18.4.3/`
4. **Logs dans git** - `*.log`, `build.log`, `server.log`
5. **Fichiers de build** - `mingw-temp.zip`, `go-ipfs_v0.24.0_linux-amd64.tar.gz`
6. **Scripts √©parpill√©s** - Scripts √† la racine ET dans `scripts/`
7. **Documentation fragment√©e** - Docs √† la racine ET dans `docs/`

### ‚úÖ Structure Actuelle (Bonne)

```
monero.marketplace/
‚îú‚îÄ‚îÄ server/          ‚úÖ Crate principal
‚îú‚îÄ‚îÄ wallet/          ‚úÖ Crate wallet
‚îú‚îÄ‚îÄ common/          ‚úÖ Crate commun
‚îú‚îÄ‚îÄ cli/             ‚úÖ Crate CLI
‚îú‚îÄ‚îÄ reputation/      ‚úÖ Module reputation
‚îú‚îÄ‚îÄ templates/       ‚úÖ Templates Tera
‚îú‚îÄ‚îÄ static/          ‚úÖ Assets frontend
‚îî‚îÄ‚îÄ scripts/         ‚úÖ Scripts utilitaires
```

---

## üéØ STRUCTURE PROPOS√âE (Standard Rust)

```
monero-marketplace/
‚îÇ
‚îú‚îÄ‚îÄ üì¶ WORKSPACE CRATES
‚îÇ   ‚îú‚îÄ‚îÄ crates/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ server/              # Serveur web principal
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ wallet/              # Client Monero RPC
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ common/              # Types & erreurs partag√©s
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cli/                 # Outils CLI
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ reputation/          # Module r√©putation
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ common/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ crypto/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ wasm/
‚îÇ
‚îú‚îÄ‚îÄ üìÅ ASSETS & RESOURCES
‚îÇ   ‚îú‚îÄ‚îÄ static/                  # CSS, JS, images
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ css/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ js/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ wasm/
‚îÇ   ‚îú‚îÄ‚îÄ templates/               # Templates Tera
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ listings/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ orders/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ partials/
‚îÇ   ‚îî‚îÄ‚îÄ migrations/              # Migrations DB (consolid√©es)
‚îÇ
‚îú‚îÄ‚îÄ üìö DOCUMENTATION
‚îÇ   ‚îú‚îÄ‚îÄ docs/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ architecture/        # Design docs
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api/                 # API specs
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ deployment/          # Guides d√©ploiement
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ development/         # Guides dev
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ security/            # Audits & security
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ milestones/          # Rapports milestones
‚îÇ   ‚îî‚îÄ‚îÄ README.md
‚îÇ
‚îú‚îÄ‚îÄ üîß SCRIPTS & TOOLS
‚îÇ   ‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dev/                 # Scripts d√©veloppement
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ deploy/              # Scripts d√©ploiement
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ test/                # Scripts de test
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ setup/               # Scripts d'installation
‚îÇ   ‚îî‚îÄ‚îÄ tools/                   # Outils custom (Python, etc.)
‚îÇ
‚îú‚îÄ‚îÄ üê≥ INFRASTRUCTURE
‚îÇ   ‚îú‚îÄ‚îÄ .github/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ workflows/           # CI/CD
‚îÇ   ‚îú‚îÄ‚îÄ docker/                  # Dockerfiles
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ server/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ monero/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ipfs/
‚îÇ   ‚îî‚îÄ‚îÄ deploy/                  # Configs d√©ploiement
‚îÇ       ‚îú‚îÄ‚îÄ nginx/
‚îÇ       ‚îú‚îÄ‚îÄ systemd/
‚îÇ       ‚îî‚îÄ‚îÄ terraform/
‚îÇ
‚îú‚îÄ‚îÄ üß™ TESTS
‚îÇ   ‚îú‚îÄ‚îÄ tests/                   # Tests d'int√©gration workspace
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ e2e/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ integration/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ fixtures/
‚îÇ   ‚îî‚îÄ‚îÄ benches/                 # Benchmarks
‚îÇ
‚îú‚îÄ‚îÄ üìã CONFIG FILES (Racine)
‚îÇ   ‚îú‚îÄ‚îÄ Cargo.toml               # Workspace root
‚îÇ   ‚îú‚îÄ‚îÄ Cargo.lock
‚îÇ   ‚îú‚îÄ‚îÄ .gitignore
‚îÇ   ‚îú‚îÄ‚îÄ .env.example
‚îÇ   ‚îú‚îÄ‚îÄ rust-toolchain.toml
‚îÇ   ‚îú‚îÄ‚îÄ rustfmt.toml
‚îÇ   ‚îî‚îÄ‚îÄ clippy.toml
‚îÇ
‚îî‚îÄ‚îÄ üìñ DOCS RACINE (Essentiels uniquement)
    ‚îú‚îÄ‚îÄ README.md                # Guide principal
    ‚îú‚îÄ‚îÄ CHANGELOG.md             # Historique versions
    ‚îú‚îÄ‚îÄ CONTRIBUTING.md          # Guide contribution
    ‚îú‚îÄ‚îÄ LICENSE
    ‚îî‚îÄ‚îÄ SECURITY.md              # Security policy
```

---

## üîÑ PLAN DE MIGRATION

### Phase 1: Nettoyage (30 min)

#### 1.1 Supprimer fichiers temporaires
```bash
# Binaires et archives
rm -rf buyer linux64 mingw-temp.zip
rm -rf monero-x86_64-linux-gnu-v0.18.4.3/
rm -rf go-ipfs/ go-ipfs_v0.24.0_linux-amd64.tar.gz

# Logs
rm -f *.log server*.log build.log ipfs.log

# Dossiers temporaires
rm -rf 4.5/ 4.s/ archive/ venv/ node_modules/

# Fichiers de test
rm -f test.txt cookies.txt buyer.* ma_requette.json

# Python temporaire
rm -f code_validator_mcp.py main.py models.py requirements.txt
```

#### 1.2 Mettre √† jour .gitignore
```gitignore
# Binaires
buyer
vendor
arbiter
linux64
*.exe

# Logs
*.log
server*.log

# Archives
*.tar.gz
*.zip

# Python
venv/
__pycache__/
*.pyc

# Node
node_modules/

# Monero
monero-*/
*.keys
*.address.txt

# IPFS
go-ipfs/

# Build
target/
*.db
*.db-*
```

### Phase 2: R√©organiser Documentation (45 min)

#### 2.1 Cr√©er structure docs/
```bash
mkdir -p docs/{architecture,api,deployment,development,security,milestones}
```

#### 2.2 D√©placer fichiers
```bash
# Architecture
mv PLAN-COMPLET.md docs/architecture/
mv ROADMAP.md docs/architecture/
mv PHASE-*.md docs/architecture/

# Milestones
mv MILESTONE-*.md docs/milestones/
mv BETA-TERMINAL-*.md docs/milestones/
mv ALPHA-TERMINAL-*.md docs/milestones/
mv COMPLETION-*.md docs/milestones/
mv SUCCESS-*.md docs/milestones/

# Security
mv SECURITY.md docs/security/
mv SECURITY_*.md docs/security/
mv AUDIT-*.md docs/security/
mv NON-CUSTODIAL-*.md docs/security/

# Development
mv DEV_TESTING.md docs/development/
mv QUICK-START-*.md docs/development/
mv MIGRATION-*.md docs/development/
mv REFACTORING_*.md docs/development/

# Deployment
mv STAGING-DEPLOYMENT-REPORT.md docs/deployment/
mv PRODUCTION-READY-*.md docs/deployment/

# Protocols
mv PROTOCOLE-*.md docs/development/protocols/

# Guides
mv CLAUDE.md docs/development/
mv GEMINI*.md docs/development/
```

#### 2.3 Garder √† la racine (essentiels)
```bash
# Garder uniquement
README.md
CHANGELOG.md (cr√©er)
CONTRIBUTING.md (cr√©er)
LICENSE
SECURITY.md (lien vers docs/security/)
TAF.md (TODO list - temporaire)
```

### Phase 3: R√©organiser Crates (1h)

#### 3.1 Cr√©er structure crates/
```bash
mkdir -p crates
mv server crates/
mv wallet crates/
mv common crates/
mv cli crates/
mv reputation crates/
```

#### 3.2 Mettre √† jour Cargo.toml racine
```toml
[workspace]
members = [
    "crates/server",
    "crates/wallet",
    "crates/common",
    "crates/cli",
    "crates/reputation/common",
    "crates/reputation/crypto",
    "crates/reputation/wasm",
]
resolver = "2"

[workspace.package]
version = "4.0.0"
edition = "2021"
authors = ["Monero Marketplace Team"]
license = "MIT"
repository = "https://github.com/Satisfyguy/solid-sniffle"

[workspace.dependencies]
# Versions partag√©es
tokio = { version = "1.48", features = ["full"] }
actix-web = "4.11"
serde = { version = "1.0", features = ["derive"] }
# ... etc
```

#### 3.3 Mettre √† jour chemins dans Cargo.toml des crates
```toml
# crates/server/Cargo.toml
[dependencies]
monero-marketplace-common = { path = "../common" }
monero-marketplace-wallet = { path = "../wallet" }
reputation-common = { path = "../reputation/common" }
```

### Phase 4: R√©organiser Scripts (30 min)

```bash
mkdir -p scripts/{dev,deploy,test,setup}

# Dev
mv start-server.sh scripts/dev/
mv setup_dev_env.sh scripts/dev/
mv install-*.sh scripts/setup/

# Test
mv test-*.sh scripts/test/
mv beta-terminal-protocol*.sh scripts/test/

# Deploy
mv market-prod.sh scripts/deploy/
mv build.sh scripts/deploy/

# Nettoyer scripts/ existant
# Organiser par cat√©gorie
```

### Phase 5: Infrastructure (30 min)

```bash
mkdir -p deploy/{nginx,systemd,terraform}
mkdir -p docker/{server,monero,ipfs}

# D√©placer configs existantes
mv 4.5/nginx/ deploy/nginx/ 2>/dev/null || true
mv 4.5/docker/ docker/ 2>/dev/null || true
```

### Phase 6: Migrations DB (15 min)

```bash
# Consolider migrations
mkdir -p migrations
cp crates/server/migrations/* migrations/ 2>/dev/null || true
cp crates/reputation/migrations/* migrations/ 2>/dev/null || true

# Renommer avec timestamps
# 001_initial_schema.sql
# 002_add_reputation.sql
# etc.
```

---

## ‚úÖ VALIDATION POST-MIGRATION

### Checklist

```bash
# 1. Build workspace
cargo build --workspace
# ‚úÖ Doit compiler sans erreurs

# 2. Tests
cargo test --workspace
# ‚úÖ Tous les tests passent

# 3. Clippy
cargo clippy --workspace --all-targets -- -D warnings
# ‚úÖ 0 erreurs

# 4. Chemins templates
# ‚úÖ V√©rifier que templates/ est accessible

# 5. Static assets
# ‚úÖ V√©rifier que static/ est accessible

# 6. Scripts
chmod +x scripts/**/*.sh
# ‚úÖ Tous ex√©cutables

# 7. Documentation
# ‚úÖ Liens dans README.md mis √† jour

# 8. Git
git status
# ‚úÖ Pas de fichiers perdus
```

---

## üìù FICHIERS √Ä CR√âER

### 1. CHANGELOG.md
```markdown
# Changelog

## [4.0.0] - 2025-10-26

### Added
- Frontend complet avec design noir brutal
- Syst√®me de commandes op√©rationnel
- Notifications WebSocket temps r√©el
- Module r√©putation avec signatures cryptographiques

### Changed
- Restructuration compl√®te du projet
- Organisation en workspace Rust standard

### Fixed
- 14 erreurs Clippy corrig√©es
- 38 violations security theatre justifi√©es
```

### 2. CONTRIBUTING.md
```markdown
# Guide de Contribution

## Structure du Projet
- `crates/` - Crates Rust
- `docs/` - Documentation
- `scripts/` - Scripts utilitaires
- `static/` - Assets frontend
- `templates/` - Templates Tera

## D√©veloppement
```bash
# Setup
./scripts/setup/setup_dev_env.sh

# Run
./scripts/dev/start-server.sh

# Test
cargo test --workspace
```

## Standards
- Rust 2021 edition
- Clippy strict mode
- 0 security theatre
```

### 3. rust-toolchain.toml
```toml
[toolchain]
channel = "stable"
components = ["rustfmt", "clippy"]
profile = "default"
```

### 4. rustfmt.toml
```toml
edition = "2021"
max_width = 100
hard_tabs = false
tab_spaces = 4
```

### 5. clippy.toml
```toml
cognitive-complexity-threshold = 30
```

---

## üéØ B√âN√âFICES

### Avant
```
‚ùå 80+ fichiers markdown √† la racine
‚ùå Binaires dans git
‚ùå Logs dans git
‚ùå Structure confuse
‚ùå Difficile √† naviguer
```

### Apr√®s
```
‚úÖ 5 fichiers essentiels √† la racine
‚úÖ Documentation organis√©e
‚úÖ Structure Rust standard
‚úÖ Facile √† maintenir
‚úÖ Pr√™t pour contribution open-source
```

---

## ‚è±Ô∏è TEMPS TOTAL ESTIM√â

| Phase | Dur√©e | Risque |
|-------|-------|--------|
| Phase 1: Nettoyage | 30 min | üü¢ Faible |
| Phase 2: Documentation | 45 min | üü¢ Faible |
| Phase 3: Crates | 1h | üü° Moyen |
| Phase 4: Scripts | 30 min | üü¢ Faible |
| Phase 5: Infrastructure | 30 min | üü¢ Faible |
| Phase 6: Migrations | 15 min | üü¢ Faible |
| **TOTAL** | **3h30** | üü¢ **Faible** |

---

## üöÄ RECOMMANDATION

**‚úÖ OUI, on peut r√©organiser sans risque!**

**Approche recommand√©e:**
1. Cr√©er une branche `restructure`
2. Faire la migration phase par phase
3. Tester apr√®s chaque phase
4. Merger quand tout fonctionne

**Commande pour d√©marrer:**
```bash
git checkout -b restructure
git add -A
git commit -m "checkpoint: avant restructuration"
```

Voulez-vous que je commence la restructuration?
